<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>NICSTEM - Enhanced NICU EHR Interface</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Inter:wght@300;400;500;700&display=swap');
        
        :root {
            --amber: #FFB000;
            --amber-light: rgba(255, 176, 0, 0.15);
            --amber-medium: rgba(255, 176, 0, 0.3);
            --amber-dark: #CC8800;
            --black-bg: #000000;
            --black-panel: rgba(0, 0, 0, 0.7);
            --text-glow: 0 0 5px rgba(255, 176, 0, 0.7);
            
            --green: #2ECC71;
            --green-light: rgba(46, 204, 113, 0.15);
            --green-dark: #27AE60;
            --yellow: #F39C12;
            --yellow-light: rgba(243, 156, 18, 0.15);
            --yellow-dark: #D35400;
            --red: #E74C3C;
            --red-light: rgba(231, 76, 60, 0.15);
            --red-dark: #C0392B;
            --blue: #3498DB;
            --blue-dark: #2980B9;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: var(--black-bg);
            color: var(--amber);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            text-shadow: var(--text-glow);
            line-height: 1.5;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        .scan-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                transparent 50%,
                rgba(0, 0, 0, 0.2) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 100;
            opacity: 0.3;
        }
        
        .patient-banner {
            background: var(--black-panel);
            border-bottom: 1px solid var(--amber);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }
        
        .patient-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .patient-name {
            font-size: 16px;
            font-weight: bold;
        }
        
        .patient-details {
            font-size: 12px;
            display: flex;
            gap: 15px;
        }
        
        .detail {
            display: flex;
            gap: 5px;
        }
        
        .label {
            color: var(--amber-dark);
        }
        
        .critical-values {
            display: flex;
            gap: 15px;
        }
        
        .critical-value {
            background: var(--amber-light);
            border: 1px solid var(--amber);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .pulse {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--amber);
            margin-right: 5px;
            box-shadow: 0 0 10px var(--amber);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        .system-info-bar {
            background: var(--black-panel);
            border-bottom: 1px solid var(--amber-dark);
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 40px;
        }
        
        .version-info {
            flex-shrink: 0;
            display: flex;
            align-items: center;
        }
        
        .version-number {
            font-size: 12px;
            color: var(--amber-dark);
        }
        
        .system-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--amber);
            flex-grow: 0;
            text-align: center;
            flex-basis: 33%;
        }
        
        .system-attribution {
            font-size: 12px;
            color: var(--amber-dark);
            font-style: italic;
            text-align: right;
            flex-grow: 1;
        }
        
        .main-container {
            display: flex;
            height: calc(100vh - 100px);
            position: relative;
        }
        
        .baby-diagram-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            height: 600px;
            z-index: 10;
        }
        
        .baby-diagram {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .baby-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.8;
        }
        
        .system-marker {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(0,0,0,0.6);
            border: 2px solid var(--amber);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 20;
        }
        
        .system-marker:hover {
            transform: scale(1.15);
            background: var(--amber-light);
        }
        
        .system-marker.normal {
            border-color: var(--green);
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
        }
        
        .system-marker.warning {
            border-color: var(--yellow);
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);
        }
        
        .system-marker.critical {
            border-color: var(--red);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.5);
        }
        
        .marker-tooltip {
            position: absolute;
            background: var(--black-panel);
            color: var(--amber);
            border: 1px solid var(--amber-dark);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 30;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        
        .system-marker:hover .marker-tooltip {
            opacity: 1;
        }
        
        /* System marker positions */
        #system-neuro {
            top: 50px;
            left: 230px;
        }
        
        #system-respiratory {
            top: 180px;
            left: 230px;
        }
        
        #system-cardiac {
            top: 170px;
            left: 170px;
        }
        
        #system-gi {
            top: 260px;
            left: 230px;
        }
        
        #system-renal {
            top: 320px;
            left: 190px;
        }
        
        #system-infectious {
            top: 400px;
            left: 270px;
        }
        
        #system-skin {
            top: 220px;
            left: 310px;
        }
        
        #system-endocrine {
            top: 290px;
            left: 290px;
        }
        
        .connection-line {
            position: absolute;
            border-top: 2px dashed var(--amber-dark);
            z-index: 5;
            transform-origin: left center;
        }
        
        .left-panel {
            width: 350px;
            background: var(--black-panel);
            border-right: 1px solid var(--amber-dark);
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            opacity: 0.8;
            transition: opacity 0.3s;
            z-index: 15;
        }
        
        .left-panel:hover {
            opacity: 1;
        }
        
        .category-tabs {
            display: flex;
            border-bottom: 1px solid var(--amber-dark);
            margin-bottom: 15px;
        }
        
        .category-tab {
            padding: 8px 0;
            flex: 1;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .category-tab.active {
            border-bottom: 2px solid var(--amber);
            color: var(--amber);
            font-weight: 500;
        }
        
        .category-tab:not(.active) {
            color: var(--amber-dark);
        }
        
        .clinical-alert {
            background: var(--amber-light);
            border: 1px solid var(--amber);
            border-radius: 4px;
            padding: 12px;
            margin: 15px 0;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-icon {
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .alert-content {
            flex: 1;
        }
        
        .protocol-progress {
            margin-top: 8px;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--green);
            border-radius: 4px;
            width: 85%;
        }
        
        .protocol-note {
            font-size: 11px;
            font-style: italic;
            color: var(--amber-dark);
            margin-top: 3px;
        }
        
        .goal-list {
            margin-bottom: 20px;
        }
        
        .goal-category {
            margin-bottom: 15px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--amber-dark);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .category-header {
            background: var(--amber-light);
            padding: 12px;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--amber-dark);
        }
        
        .protocol-metrics {
            display: flex;
            align-items: center;
        }
        
        .protocol-status {
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--amber-dark);
            font-size: 12px;
        }
        
        .protocol-status.compliant {
            background: rgba(46, 204, 113, 0.2);
            border-color: var(--green);
        }
        
        .protocol-status.warning {
            background: rgba(243, 156, 18, 0.2);
            border-color: var(--yellow);
        }
        
        .protocol-status.critical {
            background: rgba(231, 76, 60, 0.2);
            border-color: var(--red);
        }
        
        .goal-item {
            padding: 15px;
            border-bottom: 1px solid rgba(204, 136, 0, 0.3);
            position: relative;
        }
        
        .goal-item:last-child {
            border-bottom: none;
        }
        
        .goal-toggle {
            display: flex;
            align-items: flex-start;
            cursor: pointer;
        }
        
        .goal-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 1px solid var(--amber);
            border-radius: 3px;
            background: rgba(0,0,0,0.5);
            cursor: pointer;
            position: relative;
            margin-right: 12px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .goal-checkbox:checked {
            background: var(--amber-dark);
        }
        
        .goal-checkbox:checked::after {
            content: "âœ“";
            position: absolute;
            color: var(--amber);
            font-size: 12px;
            top: 2px;
            left: 4px;
        }
        
        .goal-content {
            flex: 1;
        }
        
        .goal-label {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--amber);
            display: flex;
            align-items: center;
        }
        
        .protocol-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 8px;
            text-transform: uppercase;
        }
        
        .badge-compliant {
            background-color: rgba(46, 204, 113, 0.7);
            color: #000;
        }
        
        .badge-warning {
            background-color: rgba(243, 156, 18, 0.7);
            color: #000;
        }
        
        .badge-critical {
            background-color: rgba(231, 76, 60, 0.7);
            color: #000;
        }
        
        .goal-controls {
            margin-top: 12px;
            display: none;
        }
        
        .goal-checkbox:checked ~ .goal-content .goal-controls {
            display: block;
        }
        
        .value-display {
            display: flex;
            align-items: center;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 10px;
            width: 100%;
        }
        
        .value-display-label {
            flex-shrink: 0;
            color: var(--amber-dark);
            margin-right: 10px;
            font-size: 13px;
            width: 60px;
        }
        
        .value-change {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }
        
        .current-value {
            flex: 1;
            padding: 5px 8px;
            border-radius: 4px;
            background: rgba(0,0,0,0.4);
            color: var(--amber-dark);
            text-align: center;
            font-size: 13px;
        }
        
        .arrow {
            margin: 0 8px;
            color: var(--amber-dark);
        }
        
        .target-value {
            flex: 1;
            padding: 5px 8px;
            border-radius: 4px;
            background: var(--amber-light);
            color: var(--amber);
            text-align: center;
            border: 1px solid var(--amber-dark);
            font-size: 13px;
        }
        
        .slider-container {
            width: 100%;
            padding: 0 5px;
        }
        
        .slider-input {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: rgba(0,0,0,0.5);
            border-radius: 3px;
            outline: none;
        }
        
        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--amber);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px var(--amber);
        }
        
        .slider-input::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--amber);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px var(--amber);
            border: none;
        }
        
        .slider-input::-webkit-slider-runnable-track {
            height: 6px;
            background: var(--amber-dark);
            border-radius: 3px;
        }
        
        .protocol-message {
            font-size: 11px;
            padding: 5px 10px;
            margin-top: 8px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .protocol-message-compliant {
            background-color: rgba(46, 204, 113, 0.15);
            color: #2ECC71;
        }
        
        .protocol-message-warning {
            background-color: rgba(243, 156, 18, 0.15);
            color: #F39C12;
        }
        
        .protocol-message-critical {
            background-color: rgba(231, 76, 60, 0.15);
            color: #E74C3C;
        }
        
        .protocol-tip {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
            font-size: 11px;
        }
        
        .tip-icon {
            color: var(--amber);
        }
        
        .rule-info {
            font-size: 11px;
            color: var(--amber-dark);
            margin-left: 5px;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .protocol-info {
            display: inline-block;
            font-size: 11px;
            color: var(--amber-dark);
            margin-left: 5px;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .generate-btn {
            background: var(--amber-light);
            border: 1px solid var(--amber);
            border-radius: 4px;
            color: var(--amber);
            padding: 15px;
            margin-top: auto;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            text-shadow: var(--text-glow);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 15px;
        }
        
        .generate-btn:hover {
            background: var(--amber-medium);
        }
        
        /* Note Editor Panel */
        .right-panel {
            width: 350px;
            background: var(--black-panel);
            border-left: 1px solid var(--amber-dark);
            padding: 15px;
            overflow-y: auto;
            opacity: 0.8;
            transition: opacity 0.3s;
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            z-index: 15;
            display: flex;
            flex-direction: column;
        }
        
        .right-panel:hover {
            opacity: 1;
        }
        
        .note-editor-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--amber-dark);
        }
        
        .note-editor-title {
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .note-type-dropdown {
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--amber-dark);
            border-radius: 4px;
            color: var(--amber);
            padding: 5px 10px;
            font-size: 13px;
            appearance: none;
            cursor: pointer;
        }
        
        .note-type-dropdown:focus {
            border-color: var(--amber);
            outline: none;
        }
        
        .note-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--amber-dark);
        }
        
        .note-tab {
            padding: 8px 15px;
            font-size: 13px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .note-tab.active {
            border-bottom: 2px solid var(--amber);
            color: var(--amber);
            font-weight: 500;
        }
        
        .note-tab:not(.active) {
            color: var(--amber-dark);
        }
        
        .note-content {
            flex: 1;
            overflow-y: auto;
            font-family: 'Share Tech Mono', monospace;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .note-section {
            margin-bottom: 20px;
            border-bottom: 1px dotted var(--amber-dark);
            padding-bottom: 15px;
        }
        
        .note-section:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .note-header {
            color: var(--amber);
            font-weight: bold;
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .note-header:hover {
            color: var(--amber-dark);
        }
        
        .toggle-icon {
            font-size: 12px;
            transition: transform 0.3s;
        }
        
        .collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        
        .note-body {
            transition: max-height 0.3s, opacity 0.3s;
            max-height: 1000px;
            opacity: 1;
            overflow: hidden;
        }
        
        .collapsed .note-body {
            max-height: 0;
            opacity: 0;
        }
        
        [contenteditable="true"] {
            outline: none;
            border-bottom: 1px dashed transparent;
            transition: border-color 0.2s;
            padding: 3px 0;
        }
        
        [contenteditable="true"]:hover,
        [contenteditable="true"]:focus {
            border-bottom-color: var(--amber-dark);
        }
        
        .highlight {
            background: var(--amber-light);
            padding: 2px 0;
        }
        
        .auto-gen-notice {
            font-style: italic;
            color: var(--amber-dark);
            font-size: 11px;
            margin-top: 5px;
        }
        
        .note-tools {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }
        
        .tool-button {
            flex: 1;
            background: transparent;
            border: 1px solid var(--amber);
            border-radius: 4px;
            color: var(--amber);
            padding: 8px 0;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tool-button:hover {
            background: var(--amber-light);
        }
        
        .tool-button.primary {
            background: var(--amber-light);
        }
        
        .system-alert {
            position: absolute;
            padding: 8px 12px;
            font-size: 12px;
            background: var(--amber-light);
            border: 1px solid var(--amber);
            border-radius: 4px;
            z-index: 25;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            pointer-events: none;
        }
        
        .system-alert.warning {
            background: rgba(243, 156, 18, 0.2);
            border-color: var(--yellow);
        }
        
        .system-alert.critical {
            background: rgba(231, 76, 60, 0.2);
            border-color: var(--red);
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--amber);
            color: black;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--amber-dark);
            border-top: 4px solid var(--amber);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        .loading-text {
            color: var(--amber);
            font-size: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* System Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .system-modal {
            background: var(--black-panel);
            border: 2px solid var(--amber);
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(255, 176, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s;
            overflow: hidden;
        }
        
        .modal-overlay.visible .system-modal {
            transform: scale(1);
        }
        
        .modal-header {
            background: var(--amber-light);
            padding: 15px 20px;
            border-bottom: 1px solid var(--amber);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .system-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-normal {
            background: var(--green);
            color: #000;
        }
        
        .status-warning {
            background: var(--yellow);
            color: #000;
        }
        
        .status-critical {
            background: var(--red);
            color: #000;
        }
        
        .modal-controls {
            display: flex;
            gap: 10px;
        }
        
        .modal-control-button {
            background: transparent;
            border: 1px solid var(--amber);
            border-radius: 4px;
            color: var(--amber);
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .modal-control-button:hover {
            background: var(--amber-medium);
        }
        
        .modal-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(90vh - 130px);
        }
        
        .modal-section {
            margin-bottom: 20px;
            border-bottom: 1px dotted var(--amber-dark);
            padding-bottom: 20px;
        }
        
        .modal-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--amber);
        }
        
        .condition-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .condition-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            border: 1px solid var(--amber-dark);
        }
        
        .condition-name {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .condition-status {
            font-size: 13px;
            color: var(--amber-dark);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            background: var(--amber-light);
            border-radius: 4px;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .stat-name {
            font-size: 13px;
            color: var(--amber-dark);
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: 500;
        }
        
        .stat-time {
            font-size: 11px;
            color: var(--amber-dark);
            margin-top: 5px;
            align-self: flex-end;
        }
        
        .intervention-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .intervention-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            border: 1px solid var(--amber-dark);
        }
        
        .intervention-name {
            font-size: 14px;
        }
        
        .intervention-status {
            font-size: 13px;
            color: var(--amber-dark);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 15px 20px;
            border-top: 1px solid var(--amber-dark);
            background: var(--amber-light);
        }
        
        .modal-action-button {
            background: transparent;
            border: 1px solid var(--amber);
            border-radius: 4px;
            color: var(--amber);
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .modal-action-button:hover {
            background: var(--amber-medium);
        }
        
        .modal-action-button.primary {
            background: var(--amber-medium);
        }
        
        .modal-notes {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--amber-dark);
            border-radius: 4px;
            padding: 10px;
        }
        
        .note-item {
            padding-bottom: 8px;
            margin-bottom: 8px;
            border-bottom: 1px dotted rgba(204, 136, 0, 0.3);
        }
        
        .note-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .note-metadata {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--amber-dark);
            margin-bottom: 5px;
        }
        
        .note-text {
            font-size: 13px;
        }
        
        .trend-chart {
            height: 130px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--amber-dark);
            border-radius: 4px;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .chart-line {
            position: absolute;
            top: 30px;
            left: 0;
            width: 100%;
            height: 70px;
            padding: 0 20px;
            display: flex;
            align-items: center;
        }
        
        .chart-svg {
            width: 100%;
            height: 100%;
        }
        
        .chart-path {
            stroke: var(--amber);
            stroke-width: 2;
            fill: none;
        }
        
        .chart-labels {
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
        }
        
        .chart-label {
            font-size: 10px;
            color: var(--amber-dark);
            text-align: center;
        }
        
        .goals-section {
            margin-top: 20px;
        }
        
        .goal-pill {
            display: inline-block;
            background: var(--amber-light);
            border: 1px solid var(--amber);
            border-radius: 12px;
            padding: 4px 12px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .goal-pill:hover {
            background: var(--amber-medium);
        }
        
        .goal-pill-icon {
            margin-right: 5px;
        }
        
        /* Add to Note Button */
        .add-to-note-btn {
            position: absolute;
            bottom: 70px;
            right: 370px;
            background: var(--amber-medium);
            border: 1px solid var(--amber);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 30;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .add-to-note-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 176, 0, 0.5);
        }
        
        /* Template Styles */
        #template-content {
            display: none;
        }
        
        /* History Dropdown */
        .history-dropdown {
            position: absolute;
            background: var(--black-panel);
            border: 1px solid var(--amber-dark);
            border-radius: 4px;
            width: 250px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            display: none;
        }
        
        .history-item {
            padding: 10px 15px;
            border-bottom: 1px dotted var(--amber-dark);
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .history-item:hover {
            background: var(--amber-light);
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .history-date {
            font-size: 11px;
            color: var(--amber-dark);
        }
        
        /* AI Assistance Tooltip */
        .ai-tooltip {
            position: absolute;
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid var(--blue);
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 12px;
            max-width: 250px;
            z-index: 25;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .ai-tooltip.visible {
            opacity: 1;
        }
        
        .ai-icon {
            position: absolute;
            font-size: 14px;
            color: var(--blue);
            cursor: pointer;
            z-index: 5;
        }
        
        /* New Patient Summary Widget */
        .patient-summary-widget {
            position: absolute;
            top: 15px;
            left: 380px;
            background: var(--black-panel);
            border: 1px solid var(--amber);
            border-radius: 8px;
            padding: 15px;
            width: 350px;
            z-index: 40;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
        }
        
        .patient-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--amber-dark);
            padding-bottom: 10px;
        }
        
        .patient-summary-title {
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .patient-summary-badges {
            display: flex;
            gap: 5px;
        }
        
        .badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .badge-primary {
            background: var(--amber);
            color: #000;
        }
        
        .badge-secondary {
            background: var(--amber-dark);
            color: #fff;
        }
        
        .patient-summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .summary-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            padding: 8px;
        }
        
        .summary-item-label {
            font-size: 11px;
            color: var(--amber-dark);
            margin-bottom: 3px;
        }
        
        .summary-item-value {
            font-size: 14px;
            font-weight: 500;
        }
        
        .summary-item-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 2px;
            font-size: 11px;
        }
        
        .trend-up {
            color: var(--green);
        }
        
        .trend-down {
            color: var(--red);
        }
        
        .trend-stable {
            color: var(--amber-dark);
        }
        
        .patient-summary-alerts {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .patient-alert-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .alert-normal {
            background: var(--green-light);
            color: var(--green);
        }
        
        .alert-warning {
            background: var(--yellow-light);
            color: var(--yellow);
        }
        
        .alert-critical {
            background: var(--red-light);
            color: var(--red);
        }
        
        /* Diagnosis Management */
        .diagnosis-manager {
            margin-top: 15px;
            margin-bottom: 15px;
        }
        
        .diagnosis-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .add-diagnosis-btn {
            background: var(--amber-light);
            border: 1px solid var(--amber);
            border-radius: 4px;
            color: var(--amber);
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .add-diagnosis-btn:hover {
            background: var(--amber-medium);
        }
        
        .diagnosis-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        
        .diagnosis-table th,
        .diagnosis-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px dotted var(--amber-dark);
        }
        
        .diagnosis-table th {
            font-size: 12px;
            color: var(--amber-dark);
            font-weight: normal;
        }
        
        .diagnosis-table td {
            font-size: 13px;
        }
        
        .diagnosis-actions {
            display: flex;
            gap: 5px;
        }
        
        .diagnosis-action-btn {
            background: transparent;
            border: 1px solid var(--amber-dark);
            border-radius: 3px;
            color: var(--amber);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .diagnosis-action-btn:hover {
            background: var(--amber-light);
            border-color: var(--amber);
        }
        
        /* Medications Section */
        .medications-section {
            margin-top: 20px;
        }
        
        .medication-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .medication-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            border: 1px solid var(--amber-dark);
        }
        
        .medication-info {
            flex: 1;
        }
        
        .medication-name {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .medication-dose {
            font-size: 12px;
            color: var(--amber-dark);
            margin-top: 2px;
        }
        
        .medication-status {
            display: flex;
            align-items: center;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--amber-dark);
        }
        
        .medication-status.active {
            background: rgba(46, 204, 113, 0.2);
            border-color: var(--green);
            color: var(--green);
        }
        
        .medication-status.scheduled {
            background: rgba(243, 156, 18, 0.2);
            border-color: var(--yellow);
            color: var(--yellow);
        }
        
        .medication-status.discontinued {
            background: rgba(231, 76, 60, 0.2);
            border-color: var(--red);
            color: var(--red);
        }
        
        .medication-controls {
            display: flex;
            gap: 5px;
            margin-left: 10px;
        }
        
        .medication-action-btn {
            width: 24px;
            height: 24px;
            background: transparent;
            border: 1px solid var(--amber-dark);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--amber);
        }
        
        .medication-action-btn:hover {
            background: var(--amber-light);
            border-color: var(--amber);
        }
        
        /* Quick Order Panel */
        .quick-order-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--black-panel);
            border: 2px solid var(--amber);
            border-radius: 8px;
            width: 400px;
            max-height: 90vh;
            z-index: 2001;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            display: none;
        }
        
        .quick-order-panel.visible {
            display: flex;
            flex-direction: column;
        }
        
        .quick-order-header {
            background: var(--amber-light);
            padding: 15px;
            border-bottom: 1px solid var(--amber);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .quick-order-title {
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quick-order-content {
            padding: 15px;
            overflow-y: auto;
            max-height: calc(90vh - 120px);
        }
        
        .quick-order-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-label {
            font-size: 13px;
            color: var(--amber);
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--amber-dark);
            border-radius: 4px;
            color: var(--amber);
            padding: 8px 12px;
            font-size: 14px;
            outline: none;
            width: 100%;
            font-family: 'Inter', sans-serif;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            border-color: var(--amber);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .quick-order-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 15px;
            border-top: 1px solid var(--amber-dark);
        }
        
        /* Protocol Compliance Indicator */
        .compliance-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 5px;
        }
        
        .compliance-indicator.compliant {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--green);
            border: 1px solid var(--green);
        }
        
        .compliance-indicator.warning {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--yellow);
            border: 1px solid var(--yellow);
        }
        
        .compliance-indicator.violation {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--red);
            border: 1px solid var(--red);
        }
        
        /* Enhanced Goal UI */
        .goal-wrapper {
            position: relative;
            margin-bottom: 10px;
        }
        
        .goal-status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .goal-status-indicator.compliant {
            background-color: var(--green);
            box-shadow: 0 0 5px var(--green);
        }
        
        .goal-status-indicator.warning {
            background-color: var(--yellow);
            box-shadow: 0 0 5px var(--yellow);
        }
        
        .goal-status-indicator.violation {
            background-color: var(--red);
            box-shadow: 0 0 5px var(--red);
        }
        
        .goal-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .goal-action-btn {
            font-size: 12px;
            padding: 5px 8px;
            background: transparent;
            border: 1px solid var(--amber-dark);
            border-radius: 4px;
            color: var(--amber);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .goal-action-btn:hover {
            background: var(--amber-light);
            border-color: var(--amber);
        }
        
        .goal-timer {
            font-size: 11px;
            color: var(--amber-dark);
            margin-top: 5px;
            text-align: right;
        }
        
        /* Custom Modal Styles */
        .custom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .custom-modal.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .custom-modal-content {
            background: var(--black-panel);
            border: 2px solid var(--amber);
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(255, 176, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s;
            overflow: hidden;
        }
        
        .custom-modal.visible .custom-modal-content {
            transform: scale(1);
        }
        
        .custom-modal-header {
            background: var(--amber-light);
            padding: 15px 20px;
            border-bottom: 1px solid var(--amber);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .custom-modal-title {
            font-size: 18px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .custom-modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(90vh - 120px);
        }
        
        .custom-modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--amber-dark);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: var(--amber-light);
        }
    </style>
</head>
<body>
    <div class="scan-effect"></div>
    
    <!-- System Information Bar -->
    <div class="system-info-bar">
        <div class="version-info">
            <div class="version-number">v0.005</div>
        </div>
        <div class="system-title">NICSTEM: The NICU-centric EHR</div>
        <div class="system-attribution">Conceptualized and Designed by Arturo E. Serize, MPH, PA-C</div>
    </div>
    
    <!-- Enhanced Patient Banner -->
    <div class="patient-banner">
        <div class="patient-info">
            <div class="patient-name">Serize, Baby Arturo</div>
            <div class="patient-details">
                <div class="detail">
                    <div class="label">MRN:</div>
                    <div>1001236</div>
                </div>
                <div class="detail">
                    <div class="label">GA:</div>
                    <div>24 1/7 wks (26 3/7 corr)</div>
                </div>
                <div class="detail">
                    <div class="label">DOL:</div>
                    <div>16</div>
                </div>
                <div class="detail">
                    <div class="label">Weight:</div>
                    <div>810g (+19.1%)</div>
                </div>
            </div>
        </div>
        <div class="critical-values">
            <div class="critical-value">
                <span class="pulse"></span>
                <span id="vent-settings">Vent: Rate 40, PIP 22, PEEP 6, FiO2 35%</span>
            </div>
            <div class="critical-value">
                <span>SpO2 92-95%</span>
            </div>
            <div class="critical-value">
                <span id="feed-status">Feeds: 2ml q3h + TPN</span>
            </div>
        </div>
    </div>
    
    <!-- Patient Summary Widget -->
    <div class="patient-summary-widget" id="patient-summary">
        <div class="patient-summary-header">
            <div class="patient-summary-title">
                <span>ðŸ‘¶</span>
                <span>Patient Summary</span>
            </div>
            <div class="summary-controls">
                <button class="summary-control-btn minimize-btn" id="minimize-summary" title="Minimize">_</button>
                <button class="summary-control-btn hide-btn" id="hide-summary" title="Hide">Ã—</button>
                <button class="summary-control-btn show-btn" id="show-summary" title="Show" style="display: none;">Show Summary</button>
            </div>
        </div>
        <div class="patient-summary-content">
            <div class="patient-summary-badges">
                <span class="badge badge-primary">ELGAN Pathway</span>
                <span class="badge badge-secondary">DOL 16</span>
            </div>
        <div class="patient-summary-grid">
            <div class="summary-item">
                <div class="summary-item-label">Respiratory</div>
                <div class="summary-item-value">Vent: FiO2 35%</div>
                <div class="summary-item-trend trend-down">
                    <span>â†“</span>
                    <span>Weaning</span>
                </div>
            </div>
            <div class="summary-item">
                <div class="summary-item-label">Nutrition</div>
                <div class="summary-item-value">2ml q3h feeds</div>
                <div class="summary-item-trend trend-up">
                    <span>â†‘</span>
                    <span>Advancing</span>
                </div>
            </div>
            <div class="summary-item">
                <div class="summary-item-label">Cardiac</div>
                <div class="summary-item-value">HR 150-165</div>
                <div class="summary-item-trend trend-stable">
                    <span>â†’</span>
                    <span>Moderate PDA</span>
                </div>
            </div>
            <div class="summary-item">
                <div class="summary-item-label">Neurological</div>
                <div class="summary-item-value">Grade II IVH</div>
                <div class="summary-item-trend trend-stable">
                    <span>â†’</span>
                    <span>Stable</span>
                </div>
            </div>
        </div>
                    <div class="patient-summary-alerts">
            <div class="patient-alert-item alert-critical">
                <span>ðŸ«</span>
                <span>Respiratory: Critical - FiO2 35%, Target 30%</span>
            </div>
            <div class="patient-alert-item alert-warning">
                <span>â¤ï¸</span>
                <span>Cardiac: Warning - Moderate PDA with Lâ†’R shunt</span>
            </div>
            <div class="patient-alert-item alert-warning">
                <span>ðŸ§ </span>
                <span>Neuro: Warning - Grade II IVH, stable</span>
            </div>
            <div class="patient-alert-item alert-normal">
                <span>ðŸ½ï¸</span>
                <span>GI: Normal - Tolerating feeds, ready to advance</span>
            </div>
        </div>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Panel (Goals) - Updated with Protocol Focus -->
        <div class="left-panel">
            <!-- Protocol Tabs (replacing category tabs) -->
            <div class="category-tabs">
                <div class="category-tab active" data-tab="all">Active Protocols</div>
                <div class="category-tab" data-tab="respiratory">Respiratory</div>
                <div class="category-tab" data-tab="nutrition">Nutrition</div>
                <div class="category-tab" data-tab="other">Other</div>
            </div>
            
            <!-- Protocol Status Summary -->
            <div class="clinical-alert">
                <div class="alert-icon">ðŸ“Š</div>
                <div class="alert-content">
                    <strong>Protocol Compliance: 85%</strong>
                    <div class="protocol-progress">
                        <div class="progress-bar"></div>
                    </div>
                    <div class="protocol-note">ELGAN 24-28 week pathway (Day 16)</div>
                </div>
            </div>
            
            <!-- Goal List -->
            <div class="goal-list">
                <!-- Respiratory Goals -->
                <div class="goal-category" id="respiratory-category">
                    <div class="category-header">
                        <div>RESPIRATORY GOALS</div>
                        <div class="protocol-metrics">
                            <div class="protocol-status compliant">2/3</div>
                        </div>
                    </div>
                    
                    <!-- FiO2 Goal -->
                    <div class="goal-wrapper">
                        <div class="goal-status-indicator compliant"></div>
                        <div class="goal-item">
                            <div class="goal-toggle">
                                <input type="checkbox" class="goal-checkbox" id="goal-fio2" checked data-goal="wean-fio2" data-system="respiratory">
                                <div class="goal-content">
                                    <div class="goal-label">Wean FiO2 <span class="protocol-info" title="FiO2 maximum of 60% per ELGAN protocol #325">?</span> <span class="protocol-badge badge-compliant">Protocol</span> <span class="compliance-indicator compliant">âœ“ Compliant</span></div>
                                    <div class="rule-info">Protocol-Driven: Based on SpO2 > 92% consistently over 12h</div>
                                    <div class="goal-controls">
                                        <div class="value-display">
                                            <div class="value-display-label">FiO2</div>
                                            <div class="value-change">
                                                <div class="current-value">35%</div>
                                                <div class="arrow">â†’</div>
                                                <div class="target-value" id="fio2-target-display">30%</div>
                                            </div>
                                        </div>
                                        <div class="slider-container">
                                            <input type="range" class="slider-input" id="fio2-target" min="21" max="60" value="30" step="1">
                                        </div>
                                        <div class="protocol-message protocol-message-compliant">
                                            <span class="protocol-icon">âœ“</span>
                                            <span>Target within recommended protocol range (21-40%)</span>
                                        </div>
                                        <div class="protocol-tip">
                                            <span class="tip-icon">ðŸ’¡</span>
                                            <span>NICSTEM: Most infants at 26wk tolerate weaning to 25-30% within 48h</span>
                                        </div>
                                        <div class="goal-actions">
                                            <button class="goal-action-btn" id="action-decrease-fio2">
                                                <span>â†“</span>
                                                <span>Decrease Now</span>
                                            </button>
                                            <button class="goal-action-btn" id="action-schedule-fio2">
                                                <span>â±ï¸</span>
                                                <span>Schedule</span>
                                            </button>
                                        </div>
                                        <div class="goal-timer">Last updated: 2 hours ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PIP Goal -->
                    <div class="goal-wrapper">
                        <div class="goal-status-indicator warning"></div>
                        <div class="goal-item">
                            <div class="goal-toggle">
                                <input type="checkbox" class="goal-checkbox" id="goal-pip" data-goal="wean-pip" data-system="respiratory">
                                <div class="goal-content">
                                    <div class="goal-label">Wean PIP <span class="protocol-info" title="PIP maximum of 30 cmH2O per protocol #273">?</span> <span class="protocol-badge badge-warning">Caution</span> <span class="compliance-indicator warning">âš ï¸ Caution</span></div>
                                    <div class="rule-info">Protocol-Driven: Based on pCO2 < 50 for 24h</div>
                                    <div class="goal-controls">
                                        <div class="value-display">
                                            <div class="value-display-label">PIP</div>
                                            <div class="value-change">
                                                <div class="current-value">22 cmH2O</div>
                                                <div class="arrow">â†’</div>
                                                <div class="target-value" id="pip-target-display">20 cmH2O</div>
                                            </div>
                                        </div>
                                        <div class="slider-container">
                                            <input type="range" class="slider-input" id="pip-target" min="14" max="30" value="20" step="1">
                                        </div>
                                        <div class="protocol-message protocol-message-warning">
                                            <span class="protocol-icon">âš ï¸</span>
                                            <span>Current pCO2 (49) is borderline high. Protocol suggests waiting for pCO2 < 45 before weaning.</span>
                                        </div>
                                        <div class="goal-actions">
                                            <button class="goal-action-btn" id="action-decrease-pip">
                                                <span>â†“</span>
                                                <span>Decrease Now</span>
                                            </button>
                                            <button class="goal-action-btn" id="action-order-abg">
                                                <span>ðŸ§ª</span>
                                                <span>Order ABG</span>
                                            </button>
                                        </div>
                                        <div class="goal-timer">Last ABG: 6 hours ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ventilator Rate Goal -->
                    <div class="goal-wrapper">
                        <div class="goal-status-indicator compliant"></div>
                        <div class="goal-item">
                            <div class="goal-toggle">
                                <input type="checkbox" class="goal-checkbox" id="goal-rate" checked data-goal="maintain-rate" data-system="respiratory">
                                <div class="goal-content">
                                    <div class="goal-label">Maintain vent rate <span class="protocol-info" title="Ventilator rate 35-45 per ELGAN protocol #278">?</span> <span class="protocol-badge badge-compliant">Protocol</span> <span class="compliance-indicator compliant">âœ“ Compliant</span></div>
                                    <div class="rule-info">Protocol-Driven: Based on WOB assessment and blood gas</div>
                                    <div class="goal-controls">
                                        <div class="value-display">
                                            <div class="value-display-label">Rate</div>
                                            <div class="value-change">
                                                <div class="current-value">40/min</div>
                                                <div class="arrow">â†’</div>
                                                <div class="target-value" id="rate-target-display">40/min</div>
                                            </div>
                                        </div>
                                        <div class="slider-container">
                                            <input type="range" class="slider-input" id="rate-target" min="25" max="50" value="40" step="1">
                                        </div>
                                        <div class="protocol-message protocol-message-compliant">
                                            <span class="protocol-icon">âœ“</span>
                                            <span>Current rate optimal per protocol guidelines</span>
                                        </div>
                                        <div class="goal-actions">
                                            <button class="goal-action-btn" id="action-change-rate">
                                                <span>âš™ï¸</span>
                                                <span>Change Rate</span>
                                            </button>
                                        </div>
                                        <div class="goal-timer">Last updated: 12 hours ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Nutrition Goals -->
                <div class="goal-category" id="nutrition-category">
                    <div class="category-header">
                        <div>NUTRITION GOALS</div>
                        <div class="protocol-metrics">
                            <div class="protocol-status compliant">1/1</div>
                        </div>
                    </div>
                    
                    <!-- Feeds Goal -->
                    <div class="goal-wrapper">
                        <div class="goal-status-indicator compliant"></div>
                        <div class="goal-item">
                            <div class="goal-toggle">
                                <input type="checkbox" class="goal-checkbox" id="goal-feeds" checked data-goal="advance-feeds" data-system="gi">
                                <div class="goal-content">
                                    <div class="goal-label">Advance feeds <span class="protocol-info" title="Max advancement: 2ml/feed/day per protocol #412">?</span> <span class="protocol-badge badge-compliant">Protocol</span> <span class="compliance-indicator compliant">âœ“ Compliant</span></div>
                                    <div class="rule-info">Protocol-Driven: ELGAN feeding advancement schedule, DOL 16</div>
                                    <div class="goal-controls">
                                        <div class="value-display">
                                            <div class="value-display-label">Volume</div>
                                            <div class="value-change">
                                                <div class="current-value">2ml q3h</div>
                                                <div class="arrow">â†’</div>
                                                <div class="target-value" id="feeds-target-display">4ml q3h</div>
                                            </div>
                                        </div>
                                        <div class="slider-container">
                                            <input type="range" class="slider-input" id="feeds-target" min="1" max="10" value="4" step="1">
                                        </div>
                                        <div class="protocol-message protocol-message-compliant">
                                            <span class="protocol-icon">âœ“</span>
                                            <span>Advancement rate follows ELGAN protocol for DOL 16-21</span>
                                        </div>
                                        <div class="protocol-tip">
                                            <span class="tip-icon">ðŸ’¡</span>
                                            <span>NICSTEM: Feeding tolerance excellent, can consider faster advancement</span>
                                        </div>
                                        <div class="goal-actions">
                                            <button class="goal-action-btn" id="action-increase-feeds">
                                                <span>â†‘</span>
                                                <span>Increase Now</span>
                                            </button>
                                            <button class="goal-action-btn" id="action-check-residuals">
                                                <span>ðŸ”</span>
                                                <span>Check Residuals</span>
                                            </button>
                                        </div>
                                        <div class="goal-timer">Last feed: 1 hour ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Other Goals -->
                <div class="goal-category" id="other-category">
                    <div class="category-header">
                        <div>OTHER CLINICAL GOALS</div>
                        <div class="protocol-metrics">
                            <div class="protocol-status compliant">3/3</div>
                        </div>
                    </div>
                    
                    <!-- Antibiotics Goal -->
                    <div class="goal-wrapper">
                        <div class="goal-status-indicator compliant"></div>
                        <div class="goal-item">
                            <div class="goal-toggle">
                                <input type="checkbox" class="goal-checkbox" id="goal-abx" checked data-goal="dc-antibiotics" data-system="infectious">
                                <div class="goal-content">
                                    <div class="goal-label">D/C antibiotics <span class="protocol-info" title="Standard 7-day course per protocol #517">?</span> <span class="protocol-badge badge-compliant">Protocol</span> <span class="compliance-indicator compliant">âœ“ Compliant</span></div>
                                    <div class="rule-info">Protocol-Driven: 7-day course completion with negative cultures</div>
                                    <div class="goal-controls">
                                        <div class="value-display">
                                            <div class="value-display-label">Status</div>
                                            <div class="value-change">
                                                <div class="current-value">Day 7/7</div>
                                                <div class="arrow">â†’</div>
                                                <div class="target-value">Discontinue</div>
                                            </div>
                                        </div>
                                        <div class="protocol-message protocol-message-compliant">
                                            <span class="protocol-icon">âœ“</span>
                                            <span>Complies with antibiotic stewardship protocol</span>
                                        </div>
                                        <div class="goal-actions">
                                            <button class="goal-action-btn" id="action-dc-antibiotics">
                                                <span>ðŸ’Š</span>
                                                <span>Discontinue</span>
                                            </button>
                                            <button class="goal-action-btn" id="action-check-cultures">
                                                <span>ðŸ§«</span>
                                                <span>Check Cultures</span>
                                            </button>
                                        </div>
                                        <div class="goal-timer">Final dose: 20:00 today</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PDA Monitoring Goal -->
                    <div class="goal-wrapper">
                        <div class="goal-status-indicator compliant"></div>
                        <div class="goal-item">
                            <div class="goal-toggle">
                                <input type="checkbox" class="goal-checkbox" id="goal-pda" checked data-goal="monitor-pda" data-system="cardiac">
                                <div class="goal-content">
                                    <div class="goal-label">Monitor PDA <span class="protocol-info" title="Echo follow-up every 3-5 days per protocol #632">?</span> <span class="protocol-badge badge-compliant">Protocol</span> <span class="compliance-indicator compliant">âœ“ Compliant</span></div>
                                    <div class="rule-info">Protocol-Driven: Echo follow-up for hemodynamically significant PDA</div>
                                    <div class="goal-controls">
                                        <div class="value-display">
                                            <div class="value-display-label">Action</div>
                                            <div class="value-change">
                                                <div class="current-value">Observe</div>
                                                <div class="arrow">â†’</div>
                                                <div class="target-value">Echo in 3d</div>
                                            </div>
                                        </div>
                                        <div class="protocol-message protocol-message-compliant">
                                            <span class="protocol-icon">âœ“</span>
                                            <span>Follow-up timing complies with protocol</span>
                                        </div>
                                        <div class="goal-actions">
                                            <button class="goal-action-btn" id="action-order-echo">
                                                <span>ðŸ”Š</span>
                                                <span>Order Echo</span>
                                            </button>
                                            <button class="goal-action-btn" id="action-cardio-consult">
                                                <span>ðŸ‘©â€âš•ï¸</span>
                                                <span>Cardiology Consult</span>
                                            </button>
                                        </div>
                                        <div class="goal-timer">Last echo: 3 days ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- IVH Monitoring Goal -->
                    <div class="goal-wrapper">
                        <div class="goal-status-indicator compliant"></div>
                        <div class="goal-item">
                            <div class="goal-toggle">
                                <input type="checkbox" class="goal-checkbox" id="goal-ivh" checked data-goal="monitor-ivh" data-system="neuro">
                                <div class="goal-content">
                                    <div class="goal-label">Monitor IVH <span class="protocol-info" title="Weekly HUS for Grade II-III per protocol #708">?</span> <span class="protocol-badge badge-compliant">Protocol</span> <span class="compliance-indicator compliant">âœ“ Compliant</span></div>
                                    <div class="rule-info">Protocol-Driven: Weekly HUS for Grade II IVH</div>
                                    <div class="goal-controls">
                                        <div class="value-display">
                                            <div class="value-display-label">Action</div>
                                            <div class="value-change">
                                                <div class="current-value">Grade II</div>
                                                <div class="arrow">â†’</div>
                                                <div class="target-value">HUS in 7d</div>
                                            </div>
                                        </div>
                                        <div class="protocol-message protocol-message-compliant">
                                            <span class="protocol-icon">âœ“</span>
                                            <span>Monitoring frequency complies with protocol</span>
                                        </div>
                                        <div class="goal-actions">
                                            <button class="goal-action-btn" id="action-order-hus">
                                                <span>ðŸ§ </span>
                                                <span>Order HUS</span>
                                            </button>
                                            <button class="goal-action-btn" id="action-neuro-consult">
                                                <span>ðŸ‘©â€âš•ï¸</span>
                                                <span>Neurology Consult</span>
                                            </button>
                                        </div>
                                        <div class="goal-timer">Last HUS: 5 days ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Generate Button -->
            <button class="generate-btn" id="generate-btn">
                <span class="pulse"></span>
                <span>GENERATE PROTOCOL-DRIVEN NOTE</span>
            </button>
        </div>
        
        <!-- Center - Baby Diagram -->
        <div class="baby-diagram-container">
            <div class="baby-diagram">
                <!-- Baby Image Background -->
                <svg class="baby-image" viewBox="0 0 500 600" xmlns="http://www.w3.org/2000/svg">
                    <!-- Head -->
                    <ellipse cx="250" cy="100" rx="60" ry="70" fill="var(--amber-light)" stroke="var(--amber)" stroke-width="2" />
                    
                    <!-- Body -->
                    <path d="M190,170 
                        C180,200 180,250 190,320 
                        C200,400 190,450 180,500 
                        L220,550 
                        C230,480 230,400 240,380 
                        C250,360 260,360 270,380 
                        C280,400 280,480 290,550 
                        L330,500 
                        C320,450 310,400 320,320 
                        C330,250 330,200 320,170 
                        C300,140 210,140 190,170 Z" 
                        fill="var(--amber-light)" stroke="var(--amber)" stroke-width="2" />
                    
                    <!-- Arms -->
                    <path d="M190,170 
                        C180,175 170,180 160,200 
                        C150,220 140,260 130,290 
                        C125,300 120,310 130,315 
                        C140,320 145,310 150,300 
                        C160,280 170,250 180,230 
                        C190,210 195,200 190,170 Z" 
                        fill="var(--amber-light)" stroke="var(--amber)" stroke-width="2" />
                        
                    <path d="M320,170 
                        C330,175 340,180 350,200 
                        C360,220 370,260 380,290 
                        C385,300 390,310 380,315 
                        C370,320 365,310 360,300 
                        C350,280 340,250 330,230 
                        C320,210 315,200 320,170 Z" 
                        fill="var(--amber-light)" stroke="var(--amber)" stroke-width="2" />
                    
                    <!-- Facial Features - subtle -->
                    <ellipse cx="230" cy="90" rx="8" ry="6" fill="rgba(0,0,0,0.2)" />
                    <ellipse cx="270" cy="90" rx="8" ry="6" fill="rgba(0,0,0,0.2)" />
                    <path d="M235,110 C245,118 255,118 265,110" stroke="rgba(0,0,0,0.2)" stroke-width="2" fill="none" />
                </svg>
                
                <!-- System Markers -->
                <div id="system-neuro" class="system-marker warning" data-system="neuro">
                    ðŸ§ 
                    <div class="marker-tooltip">Neurological System (Warning)</div>
                </div>
                <div id="system-respiratory" class="system-marker critical" data-system="respiratory">
                    ðŸ«
                    <div class="marker-tooltip">Respiratory System (Critical)</div>
                </div>
                <div id="system-cardiac" class="system-marker warning" data-system="cardiac">
                    â¤ï¸
                    <div class="marker-tooltip">Cardiovascular System (Warning)</div>
                </div>
                <div id="system-gi" class="system-marker normal" data-system="gi">
                    ðŸ½ï¸
                    <div class="marker-tooltip">Gastrointestinal System (Normal)</div>
                </div>
                <div id="system-renal" class="system-marker normal" data-system="renal">
                    ðŸŽ‹
                    <div class="marker-tooltip">Renal System (Normal)</div>
                </div>
                <div id="system-skin" class="system-marker warning" data-system="skin">
                    ðŸ§¬
                    <div class="marker-tooltip">Integumentary System (Warning)</div>
                </div>
                <div id="system-infectious" class="system-marker normal" data-system="infectious">
                    ðŸ¦ 
                    <div class="marker-tooltip">Infectious Disease (Normal)</div>
                </div>
                <div id="system-endocrine" class="system-marker normal" data-system="endocrine">
                    âš—ï¸
                    <div class="marker-tooltip">Endocrine System (Normal)</div>
                </div>
                
                <!-- Connection Lines - Example -->
                <div class="connection-line" style="width: 80px; top: 175px; left: 178px; transform: rotate(0deg);"></div>
                
                <!-- System Alerts -->
                <div class="system-alert critical" style="top: 140px; left: 280px;">
                    FiO2 35% â†“ to 30% (SpO2 92-95%)
                </div>
                <div class="system-alert warning" style="top: 120px; left: 150px;">
                    Grade II IVH: Stable
                </div>
            </div>
        </div>
        
        <!-- Add to Note Button -->
        <button class="add-to-note-btn" id="add-to-note-btn" title="Add to Progress Note">
            ðŸ“
        </button>
        
        <!-- Right Panel (Note Editor) -->
        <div class="right-panel">
            <div class="note-editor-header">
                <div class="note-editor-title">
                    <span>ðŸ“</span>
                    <span>Progress Note Editor</span>
                </div>
                <select class="note-type-dropdown">
                    <option>Progress Note</option>
                    <option>Admission Note</option>
                    <option>Discharge Note</option>
                    <option>Procedure Note</option>
                    <option>Transfer Note</option>
                </select>
            </div>
            
            <div class="note-tabs">
                <div class="note-tab active" data-tab="editor">Editor</div>
                <div class="note-tab" data-tab="preview">Preview</div>
                <div class="note-tab" data-tab="template">Templates</div>
                <div class="note-tab" data-tab="history">History</div>
            </div>
            
            <div class="note-content">
                <div class="note-section">
                    <div class="note-header">
                        <span contenteditable="true">PROGRESS NOTE - PROTOCOL-DRIVEN</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="note-body">
                        <div contenteditable="true">
                            <strong>Patient:</strong> Serize, Baby Arturo | <strong>MRN:</strong> 1001236<br>
                            <strong>DOB:</strong> 04/10/2025 | <strong>GA:</strong> 24 1/7 weeks (Corrected: 26 3/7)<br>
                            <strong>DOL:</strong> 16 | <strong>Weight:</strong> 810g (+19.1% from birth)
                        </div>
                        <div class="auto-gen-notice">
                            Auto-generated from EHR data â€¢ Click to edit
                        </div>
                    </div>
                </div>
                
                <div class="note-section">
                    <div class="note-header">
                        <span contenteditable="true">24 HOUR EVENTS</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="note-body">
                        <div contenteditable="true">
                            <span class="highlight">â€¢ Desaturations: 2 significant (SpO2 &lt;85% >20 seconds), self-resolved</span><br>
                            â€¢ Bradycardia: None<br>
                            â€¢ Apnea: None<br>
                            â€¢ Afebrile<br>
                            â€¢ Blood culture (48h): No growth to date
                        </div>
                        <div class="auto-gen-notice">
                            Auto-generated from nursing flowsheets â€¢ Click to edit
                        </div>
                    </div>
                </div>
                
                <div class="note-section">
                    <div class="note-header">
                        <span contenteditable="true">RESPIRATORY</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="note-body">
                        <div contenteditable="true" id="respiratory-content">
                            <span class="highlight">â€¢ Current Support: Conventional ventilation (Rate 40, PIP 22, PEEP 6, FiO2 35% â†’ Target: 30%)</span><br>
                            <span class="highlight">â€¢ Blood Gas (6hrs ago): pH 7.29, pCO2 49, pO2 64, HCO3 22, BE -3</span><br>
                            <span class="highlight">â€¢ Work of Breathing: Minimal retractions, comfortable on current settings</span><br>
                            <span class="highlight">â€¢ Lung Exam: Symmetric breath sounds, scattered fine crackles bilaterally</span><br>
                            â€¢ Secretions: Thin, minimal<br>
                            â€¢ CXR (2 days ago): Improved aeration, persistent hazy opacities, no focal consolidation<br>
                            <span class="highlight">â€¢ Stable SpO2 92-95% on current settings</span><br>
                            <span class="highlight">â€¢ Protocol Status: ELGAN Respiratory Pathway - FiO2 and Rate compliant</span>
                        </div>
                        <div class="auto-gen-notice">
                            Generated from respiratory assessment â€¢ Protocol compliance noted â€¢ Click to edit
                        </div>
                    </div>
                </div>
                
                <div class="note-section">
                    <div class="note-header">
                        <span contenteditable="true">CARDIOVASCULAR</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="note-body">
                        <div contenteditable="true">
                            â€¢ HR 150-165, regular<br>
                            â€¢ BP 55/32 (mean 40)<br>
                            â€¢ Capillary refill &lt;3 seconds<br>
                            â€¢ Echo (3 days ago): Moderate PDA with Lâ†’R shunt, good ventricular function<br>
                            â€¢ Protocol Status: PDA Monitoring Protocol - Compliant (scheduled follow-up echo in 3d)
                        </div>
                        <div class="auto-gen-notice">
                            Generated from cardiac assessment â€¢ Click to edit
                        </div>
                    </div>
                </div>
                
                <div class="note-section">
                    <div class="note-header">
                        <span contenteditable="true">GASTROINTESTINAL</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="note-body">
                        <div contenteditable="true" id="gi-content">
                            <span class="highlight">â€¢ Current Feeds: Breastmilk 2ml q3h (trophic) â†’ Target: 4ml q3h</span><br>
                            â€¢ TPN Day 16<br>
                            <span class="highlight">â€¢ Feeding Tolerance: No emesis, minimal residuals (&lt;20% of feeds)</span><br>
                            â€¢ Abdomen: Soft, non-distended, no discoloration<br>
                            â€¢ Bowel Sounds: Present in all quadrants<br>
                            â€¢ Stool: Small, soft yellow x2 in past 24 hours<br>
                            <span class="highlight">â€¢ Protocol Status: ELGAN Feeding Protocol - Compliant with advancement schedule</span>
                        </div>
                        <div class="auto-gen-notice">
                            Generated from GI assessment â€¢ Protocol compliance noted â€¢ Click to edit
                        </div>
                    </div>
                </div>
                
                <div class="note-section">
                    <div class="note-header">
                        <span contenteditable="true">INFECTIOUS DISEASE</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="note-body">
                        <div contenteditable="true" id="id-content">
                            <span class="highlight">â€¢ Day 7 of 7 of ampicillin/gentamicin</span><br>
                            <span class="highlight">â€¢ Blood Culture (48h): No growth to date</span><br>
                            â€¢ WBC 10.2 (normal, improved from 12.8 two days ago)<br>
                            â€¢ Afebrile, no signs of infection<br>
                            <span class="highlight">â€¢ Protocol Status: Antimicrobial Stewardship Protocol - Compliant (discontinuing after 7-day course)</span>
                        </div>
                        <div class="auto-gen-notice">
                            Generated from infectious disease data â€¢ Protocol compliance noted â€¢ Click to edit
                        </div>
                    </div>
                </div>
                
                <div class="note-section">
                    <div class="note-header">
                        <span contenteditable="true">NEUROLOGY</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="note-body">
                        <div contenteditable="true">
                            â€¢ Activity: Appropriate for gestational age<br>
                            â€¢ Tone: Mild hypotonia, appropriate for gestational age<br>
                            â€¢ Head Ultrasound (5 days ago): Grade II IVH, stable from previous<br>
                            â€¢ Protocol Status: IVH Monitoring Protocol - Compliant (weekly HUS scheduled)
                        </div>
                        <div class="auto-gen-notice">
                            Generated from neurological assessment â€¢ Protocol compliance noted â€¢ Click to edit
                        </div>
                    </div>
                </div>
                
                <div class="note-section">
                    <div class="note-header">
                        <span contenteditable="true">ASSESSMENT & PLAN</span>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="note-body">
                        <div contenteditable="true" id="plan-content">
                            <strong>1. RESPIRATORY: Wean ventilator support per ELGAN protocol</strong><br>
                            <span class="highlight">â€¢ Decrease FiO2 from 35% to 33% â†’ reassess â†’ if SpO2 consistently >92%, further reduce to 30%</span><br>
                            â€¢ Continue current PIP, PEEP, and rate settings<br>
                            â€¢ Obtain blood gas in 12 hours after FiO2 change to assess ventilation status<br>
                            â€¢ Protocol compliance: 85% (2/3 goals met - FiO2 and Rate compliant, PIP weaning cautioned)
                            
                            <br><br>
                            <strong>2. NUTRITION: Advance enteral feeding per ELGAN protocol</strong><br>
                            <span class="highlight">â€¢ Increase feeds from current 2ml q3h to 3ml q3h today</span><br>
                            <span class="highlight">â€¢ If tolerated with minimal residuals, increase to 4ml q3h tomorrow</span><br>
                            â€¢ Continue current TPN; adjust fluid composition based on electrolytes<br>
                            â€¢ Protocol compliance: 100% (feeding advancement on track)
                            
                            <br><br>
                            <strong>3. INFECTIOUS DISEASE: Complete antibiotic course per protocol</strong><br>
                            <span class="highlight">â€¢ Complete 7-day course of ampicillin today (final dose at 20:00)</span><br>
                            <span class="highlight">â€¢ Complete 7-day course of gentamicin today (final dose at 20:00)</span><br>
                            <span class="highlight">â€¢ Discontinue antibiotics if blood culture remains negative at 48 hours</span><br>
                            â€¢ Protocol compliance: 100% (course completion on track)
                            
                            <br><br>
                            <strong>4. NEUROLOGY: Continue IVH monitoring per protocol</strong><br>
                            â€¢ Continue current neurological assessments<br>
                            â€¢ Schedule follow-up head ultrasound in 7 days per IVH monitoring protocol<br>
                            â€¢ Protocol compliance: 100% (monitoring schedule on track)
                            
                            <br><br>
                            <strong>5. CARDIOVASCULAR: PDA monitoring per protocol</strong><br>
                            â€¢ Continue hemodynamic monitoring<br>
                            â€¢ Schedule follow-up echo in 3 days per protocol<br>
                            â€¢ Protocol compliance: 100% (monitoring schedule on track)
                        </div>
                        <div class="auto-gen-notice">
                            Generated based on selected protocol-driven goals â€¢ Click to edit
                        </div>
                    </div>
                </div>
                
                <div id="template-content">
                    <div class="note-section">
                        <div class="note-header">
                            <span>TEMPLATE LIBRARY</span>
                            <span class="toggle-icon">â–¼</span>
                        </div>
                        <div class="note-body">
                            <div class="template-list">
                                <div class="template-item" data-template="progress">Progress Note Template</div>
                                <div class="template-item" data-template="admission">Admission Note Template</div>
                                <div class="template-item" data-template="discharge">Discharge Note Template</div>
                                <div class="template-item" data-template="procedure">Procedure Note Template</div>
                                <div class="template-item" data-template="consult">Consultation Note Template</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="note-tools">
                <button class="tool-button" id="save-btn">
                    <span>ðŸ’¾</span>
                    <span>Save</span>
                </button>
                <button class="tool-button" id="history-btn">
                    <span>ðŸ“œ</span>
                    <span>History</span>
                </button>
                <button class="tool-button primary" id="sign-btn">
                    <span>âœ“</span>
                    <span>Sign Note</span>
                </button>
            </div>
            
            <!-- History Dropdown (Initially Hidden) -->
            <div class="history-dropdown" id="history-dropdown">
                <div class="history-item">
                    <div class="history-title">Progress Note</div>
                    <div class="history-date">Today, 07:30</div>
                </div>
                <div class="history-item">
                    <div class="history-title">Progress Note</div>
                    <div class="history-date">Yesterday, 08:15</div>
                </div>
                <div class="history-item">
                    <div class="history-title">Consultant Note - Cardiology</div>
                    <div class="history-date">3 days ago, 15:45</div>
                </div>
                <div class="history-item">
                    <div class="history-title">Progress Note</div>
                    <div class="history-date">4 days ago, 08:30</div>
                </div>
                <div class="history-item">
                    <div class="history-title">Procedure Note - PICC Line</div>
                    <div class="history-date">7 days ago, 11:20</div>
                </div>
                <div class="history-item">
                    <div class="history-title">Admission Note</div>
                    <div class="history-date">DOL 0, 14:10</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Generating protocol-driven note...</div>
    </div>
    
    <!-- AI Assistance Tooltip -->
    <div class="ai-tooltip" id="ai-tooltip">
        Consider mentioning the patient's hemodynamic stability despite PDA. The murmur has been stable without signs of cardiac compromise.
    </div>
    
    <!-- Quick Order Panel -->
    <div class="quick-order-panel" id="order-panel">
        <div class="quick-order-header">
            <div class="quick-order-title">
                <span id="order-panel-icon">ðŸ§ª</span>
                <span id="order-panel-title">Quick Order: ABG</span>
            </div>
            <button class="modal-control-button" id="close-order-panel">âœ–ï¸</button>
        </div>
        <div class="quick-order-content">
            <div class="quick-order-form">
                <div class="form-group">
                    <label class="form-label" id="order-type-label">Order Type</label>
                    <select class="form-select" id="order-type">
                        <option value="stat">STAT</option>
                        <option value="urgent">URGENT</option>
                        <option value="routine" selected>ROUTINE</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" id="order-timing-label">Timing</label>
                    <select class="form-select" id="order-timing">
                        <option value="now">Now</option>
                        <option value="next-round">Next Round</option>
                        <option value="later-today">Later Today</option>
                        <option value="tomorrow">Tomorrow</option>
                        <option value="custom">Custom...</option>
                    </select>
                </div>
                <div id="custom-timing-container" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-input" id="custom-date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Time</label>
                            <input type="time" class="form-input" id="custom-time">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Special Instructions</label>
                    <textarea class="form-textarea" id="order-special-instructions" placeholder="Add any special instructions or details..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Order Reason</label>
                    <select class="form-select" id="order-reason">
                        <option value="protocol">Protocol-Driven</option>
                        <option value="acute-change">Acute Change in Status</option>
                        <option value="follow-up">Follow-up Assessment</option>
                        <option value="pre-post">Pre/Post Intervention</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div id="other-reason-container" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Specify Reason</label>
                        <input type="text" class="form-input" id="other-reason">
                    </div>
                </div>
            </div>
        </div>
        <div class="quick-order-actions">
            <button class="modal-action-button" id="cancel-order">Cancel</button>
            <button class="modal-action-button primary" id="submit-order">Submit Order</button>
        </div>
    </div>
    
    <!-- Diagnosis Management Modal for System Modal Overlays -->
    <div class="custom-modal" id="diagnoses-modal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <div class="custom-modal-title">
                    <span id="diagnoses-system-icon">ðŸ«</span>
                    <span id="diagnoses-system-title">Respiratory System Diagnoses</span>
                </div>
                <button class="modal-control-button" id="close-diagnoses-modal">âœ–ï¸</button>
            </div>
            <div class="custom-modal-body">
                <div class="diagnosis-manager">
                    <div class="diagnosis-controls">
                        <h3>Active Diagnoses</h3>
                        <button class="add-diagnosis-btn" id="add-diagnosis-btn">
                            <span>+</span>
                            <span>Add Diagnosis</span>
                        </button>
                    </div>
                    <table class="diagnosis-table" id="diagnosis-table">
                        <thead>
                            <tr>
                                <th>Diagnosis</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Respiratory Distress Syndrome</td>
                                <td>Improving</td>
                                <td>DOL 0</td>
                                <td class="diagnosis-actions">
                                    <button class="diagnosis-action-btn" title="Update">âœï¸</button>
                                    <button class="diagnosis-action-btn" title="Remove">âŒ</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Evolving Bronchopulmonary Dysplasia</td>
                                <td>Early phase</td>
                                <td>DOL 14</td>
                                <td class="diagnosis-actions">
                                    <button class="diagnosis-action-btn" title="Update">âœï¸</button>
                                    <button class="diagnosis-action-btn" title="Remove">âŒ</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="medications-section">
                    <div class="section-title">Associated Medications</div>
                    <div class="medication-list">
                        <div class="medication-item">
                            <div class="medication-info">
                                <div class="medication-name">Caffeine Citrate</div>
                                <div class="medication-dose">5 mg/kg/day</div>
                            </div>
                            <div class="medication-status active">Active</div>
                            <div class="medication-controls">
                                <button class="medication-action-btn" title="Edit">âœï¸</button>
                                <button class="medication-action-btn" title="Discontinue">â¹ï¸</button>
                            </div>
                        </div>
                        <div class="medication-item">
                            <div class="medication-info">
                                <div class="medication-name">Dexamethasone</div>
                                <div class="medication-dose">0.15 mg/kg q12h - 3 day course</div>
                            </div>
                            <div class="medication-status scheduled">Scheduled</div>
                            <div class="medication-controls">
                                <button class="medication-action-btn" title="Edit">âœï¸</button>
                                <button class="medication-action-btn" title="Cancel">âŒ</button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="add-diagnosis-btn">
                            <span>+</span>
                            <span>Add Medication</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-action-button" id="close-diagnoses-btn">Close</button>
                <button class="modal-action-button primary" id="save-diagnoses-btn">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- System Modals for All Body Systems -->
    
    <!-- Respiratory Modal -->
    <div class="modal-overlay" id="respiratory-modal">
        <div class="system-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>ðŸ«</span>
                    <span>Respiratory System</span>
                    <span class="system-status status-critical">Critical</span>
                </div>
                <div class="modal-controls">
                    <button class="modal-control-button" id="manage-respiratory-dx">ðŸ“‹</button>
                    <button class="modal-control-button modal-close">âœ–ï¸</button>
                </div>
            </div>
            <div class="modal-content">
                <div class="modal-section">
                    <div class="section-title">Protocol Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Protocol Compliance</div>
                            <div class="stat-value">ELGAN Respiratory: 85%</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">FiO2 Protocol</div>
                            <div class="stat-value">Compliant - Wean to 30%</div>
                            <div class="stat-time">Target met</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">PIP Protocol</div>
                            <div class="stat-value">Caution - pCO2 borderline</div>
                            <div class="stat-time">Reassess</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Rate Protocol</div>
                            <div class="stat-value">Compliant - maintain current</div>
                            <div class="stat-time">Target met</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Diagnoses</div>
                    <div class="condition-list">
                        <div class="condition-item">
                            <div class="condition-name">
                                <span>ðŸ›‘</span>
                                <span>Respiratory Distress Syndrome (RDS)</span>
                            </div>
                            <div class="condition-status">Improving</div>
                        </div>
                        <div class="condition-item">
                            <div class="condition-name">
                                <span>âš ï¸</span>
                                <span>Evolving Bronchopulmonary Dysplasia (BPD)</span>
                            </div>
                            <div class="condition-status">Early phase</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Ventilator Settings</div>
                            <div class="stat-value">Rate 40, PIP 22, PEEP 6, FiO2 35%</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Blood Gas</div>
                            <div class="stat-value">pH 7.29, pCO2 49, pO2 64, HCO3 22, BE -3</div>
                            <div class="stat-time">6 hours ago</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">SpO2</div>
                            <div class="stat-value">92-95% (Target 88-92%)</div>
                            <div class="stat-time">Last 24h</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Chest X-ray</div>
                            <div class="stat-value">Improved aeration, persistent haziness</div>
                            <div class="stat-time">2 days ago</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Interventions</div>
                    <div class="intervention-list">
                        <div class="intervention-item">
                            <div class="intervention-name">Mechanical Ventilation</div>
                            <div class="intervention-status">Since DOL 0, weaning per protocol</div>
                        </div>
                        <div class="intervention-item">
                            <div class="intervention-name">Surfactant</div>
                            <div class="intervention-status">Completed - 2 doses (DOL 0, 1)</div>
                        </div>
                        <div class="intervention-item">
                            <div class="intervention-name">Caffeine</div>
                            <div class="intervention-status">5 mg/kg/day</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Clinical Notes</div>
                    <div class="modal-notes">
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Dr. Martinez, Neonatology</div>
                                <div>Today, 07:30</div>
                            </div>
                            <div class="note-text">
                                Patient remains stable on current ventilator settings with minimal WOB. Blood gas shows mild respiratory acidosis. Plan to wean FiO2 if continues to maintain SpO2 >92%.
                            </div>
                        </div>
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Respiratory Therapist Johnson</div>
                                <div>Yesterday, 22:15</div>
                            </div>
                            <div class="note-text">
                                Minimal secretions. Breath sounds clear bilaterally with scattered fine crackles. Patient tolerating current settings well. Due for blood gas in morning.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Related Goals</div>
                    <div class="goals-section">
                        <div class="goal-pill" data-goal="fio2" data-add-to-note="true">
                            <span class="goal-pill-icon">ðŸŽ¯</span>
                            <span>Follow IVH Protocol - Weekly HUS</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-action-button add-to-note-action" data-system="neuro">
                    <span>ðŸ“</span>
                    <span>Add to Note</span>
                </button>
                <button class="modal-action-button" id="order-hus-btn">
                    <span>ðŸ§ </span>
                    <span>Order HUS</span>
                </button>
                <button class="modal-action-button primary" id="neuro-consult-btn">
                    <span>ðŸ‘©â€âš•ï¸</span>
                    <span>Neurology Consult</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Cardiac Modal -->
    <div class="modal-overlay" id="cardiac-modal">
        <div class="system-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>â¤ï¸</span>
                    <span>Cardiovascular System</span>
                    <span class="system-status status-warning">Warning</span>
                </div>
                <div class="modal-controls">
                    <button class="modal-control-button" id="manage-cardiac-dx">ðŸ“‹</button>
                    <button class="modal-control-button modal-close">âœ–ï¸</button>
                </div>
            </div>
            <div class="modal-content">
                <div class="modal-section">
                    <div class="section-title">Protocol Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Protocol Compliance</div>
                            <div class="stat-value">PDA Monitoring: 100%</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Echo Protocol</div>
                            <div class="stat-value">Compliant - Follow-up in 3d</div>
                            <div class="stat-time">On schedule</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Next Scheduled Echo</div>
                            <div class="stat-value">3 days</div>
                            <div class="stat-time">From today</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Diagnoses</div>
                    <div class="condition-list">
                        <div class="condition-item">
                            <div class="condition-name">
                                <span>âš ï¸</span>
                                <span>Patent Ductus Arteriosus (PDA)</span>
                            </div>
                            <div class="condition-status">Moderate, hemodynamically significant</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Heart Rate</div>
                            <div class="stat-value">150-165 bpm</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Blood Pressure</div>
                            <div class="stat-value">55/32 (mean 40)</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Echo Findings</div>
                            <div class="stat-value">Moderate PDA, Lâ†’R shunt</div>
                            <div class="stat-time">3 days ago</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Cardiac Function</div>
                            <div class="stat-value">Good ventricular function</div>
                            <div class="stat-time">3 days ago</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Trend Chart</div>
                    <div class="trend-chart">
                        <div class="chart-line">
                            <svg viewBox="0 0 600 100" class="chart-svg">
                                <path class="chart-path" d="M0,80 C50,60 100,30 150,50 C200,70 250,80 300,60 C350,40 400,30 450,40 C500,50 550,60 600,50"></path>
                            </svg>
                        </div>
                        <div class="chart-labels">
                            <div class="chart-label">DOL 10</div>
                            <div class="chart-label">DOL 12</div>
                            <div class="chart-label">DOL 14</div>
                            <div class="chart-label">DOL 16</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Clinical Notes</div>
                    <div class="modal-notes">
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Dr. Kim, Pediatric Cardiology</div>
                                <div>3 days ago, 10:15</div>
                            </div>
                            <div class="note-text">
                                Echo shows moderate PDA with Lâ†’R shunting. LV dimensions normal. Contractility good. Hemodynamically significant but patient maintains BP and perfusion. Conservative management with close monitoring recommended at this time.
                            </div>
                        </div>
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Dr. Martinez, Neonatology</div>
                                <div>Today, 07:40</div>
                            </div>
                            <div class="note-text">
                                Cardiovascular exam shows regular rhythm, good perfusion with capillary refill &lt;3 seconds. Grade 2/6 systolic murmur at LUSB. Hemodynamically stable despite moderate PDA. Continue monitoring.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Related Goals</div>
                    <div class="goals-section">
                        <div class="goal-pill" data-goal="monitor-pda" data-add-to-note="true">
                            <span class="goal-pill-icon">ðŸŽ¯</span>
                            <span>Follow PDA Protocol - Echo in 3d</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-action-button add-to-note-action" data-system="cardiac">
                    <span>ðŸ“</span>
                    <span>Add to Note</span>
                </button>
                <button class="modal-action-button" id="order-echo-btn">
                    <span>ðŸ”Š</span>
                    <span>Order Echo</span>
                </button>
                <button class="modal-action-button primary" id="cardio-consult-btn">
                    <span>ðŸ‘©â€âš•ï¸</span>
                    <span>Cardiology Consult</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- GI Modal -->
    <div class="modal-overlay" id="gi-modal">
        <div class="system-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>ðŸ½ï¸</span>
                    <span>Gastrointestinal System</span>
                    <span class="system-status status-normal">Normal</span>
                </div>
                <div class="modal-controls">
                    <button class="modal-control-button" id="manage-gi-dx">ðŸ“‹</button>
                    <button class="modal-control-button modal-close">âœ–ï¸</button>
                </div>
            </div>
            <div class="modal-content">
                <div class="modal-section">
                    <div class="section-title">Protocol Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Protocol Compliance</div>
                            <div class="stat-value">ELGAN Feeding: 100%</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Feed Advancement</div>
                            <div class="stat-value">Compliant - 2mlâ†’4ml q3h</div>
                            <div class="stat-time">On schedule</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Target Volume</div>
                            <div class="stat-value">150ml/kg/day by DOL 28</div>
                            <div class="stat-time">Protocol goal</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Enteral Feeds</div>
                            <div class="stat-value">Breastmilk 2ml q3h (trophic)</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Feeding Tolerance</div>
                            <div class="stat-value">Good - minimal residuals</div>
                            <div class="stat-time">Last 24h</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">TPN</div>
                            <div class="stat-value">Day 16 - standard formulation</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Stool Pattern</div>
                            <div class="stat-value">Small, soft yellow x2</div>
                            <div class="stat-time">Last 24h</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Trend Chart - Feeding Volume</div>
                    <div class="trend-chart">
                        <div class="chart-line">
                            <svg viewBox="0 0 600 100" class="chart-svg">
                                <path class="chart-path" d="M0,90 C50,85 100,80 150,70 C200,60 250,50 300,50 C350,50 400,50 450,50 C500,50 550,40 600,30"></path>
                            </svg>
                        </div>
                        <div class="chart-labels">
                            <div class="chart-label">DOL 10</div>
                            <div class="chart-label">DOL 12</div>
                            <div class="chart-label">DOL 14</div>
                            <div class="chart-label">DOL 16</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Clinical Notes</div>
                    <div class="modal-notes">
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Nutritionist Lin</div>
                                <div>Yesterday, 14:30</div>
                            </div>
                            <div class="note-text">
                                Patient tolerating current trophic feeds well. Ready for advancement per ELGAN protocol. Recommend increasing to 3ml q3h today and monitoring tolerance.
                            </div>
                        </div>
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Dr. Martinez, Neonatology</div>
                                <div>Today, 07:45</div>
                            </div>
                            <div class="note-text">
                                Abdomen soft, non-distended. Good bowel sounds in all quadrants. No signs of feeding intolerance. Plan to advance feeds per protocol.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Related Goals</div>
                    <div class="goals-section">
                        <div class="goal-pill" data-goal="advance-feeds" data-add-to-note="true">
                            <span class="goal-pill-icon">ðŸŽ¯</span>
                            <span>Advance Feeds to 4ml q3h</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-action-button add-to-note-action" data-system="gi">
                    <span>ðŸ“</span>
                    <span>Add to Note</span>
                </button>
                <button class="modal-action-button" id="adjust-tpn-btn">
                    <span>ðŸ’§</span>
                    <span>Adjust TPN</span>
                </button>
                <button class="modal-action-button primary" id="advance-feeds-btn">
                    <span>ðŸ¼</span>
                    <span>Advance Feeds</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Infectious Disease Modal -->
    <div class="modal-overlay" id="infectious-modal">
        <div class="system-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>ðŸ¦ </span>
                    <span>Infectious Disease</span>
                    <span class="system-status status-normal">Normal</span>
                </div>
                <div class="modal-controls">
                    <button class="modal-control-button" id="manage-infectious-dx">ðŸ“‹</button>
                    <button class="modal-control-button modal-close">âœ–ï¸</button>
                </div>
            </div>
            <div class="modal-content">
                <div class="modal-section">
                    <div class="section-title">Protocol Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Protocol Compliance</div>
                            <div class="stat-value">Antibiotic Stewardship: 100%</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Antibiotic Course</div>
                            <div class="stat-value">Compliant - 7-day course</div>
                            <div class="stat-time">Day 7/7</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">DC Criteria</div>
                            <div class="stat-value">Met - Negative cultures</div>
                            <div class="stat-time">Last result</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Antibiotics</div>
                            <div class="stat-value">Ampicillin + Gentamicin</div>
                            <div class="stat-time">Day 7/7</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Blood Culture</div>
                            <div class="stat-value">No growth to date</div>
                            <div class="stat-time">48h</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">WBC</div>
                            <div class="stat-value">10.2 (normal)</div>
                            <div class="stat-time">Today</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Temperature</div>
                            <div class="stat-value">36.8Â°C (Afebrile)</div>
                            <div class="stat-time">Current</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Lab Trends</div>
                    <div class="trend-chart">
                        <div class="chart-line">
                            <svg viewBox="0 0 600 100" class="chart-svg">
                                <path class="chart-path" d="M0,30 C50,40 100,60 150,70 C200,80 250,70 300,60 C350,50 400,40 450,30 C500,20 550,20 600,20"></path>
                            </svg>
                        </div>
                        <div class="chart-labels">
                            <div class="chart-label">DOL 10</div>
                            <div class="chart-label">DOL 12</div>
                            <div class="chart-label">DOL 14</div>
                            <div class="chart-label">DOL 16</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Clinical Notes</div>
                    <div class="modal-notes">
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Dr. Patel, Infectious Disease</div>
                                <div>Yesterday, 16:45</div>
                            </div>
                            <div class="note-text">
                                Blood culture negative at 24 hours. WBC trending down. No clinical signs of infection. Plan to complete 7-day course of antibiotics per protocol and discontinue if cultures remain negative.
                            </div>
                        </div>
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Dr. Martinez, Neonatology</div>
                                <div>Today, 07:50</div>
                            </div>
                            <div class="note-text">
                                Afebrile, no signs of infection. Blood culture negative at 48 hours. Final doses of ampicillin and gentamicin to be given at 20:00 today, then discontinue per protocol.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Related Goals</div>
                    <div class="goals-section">
                        <div class="goal-pill" data-goal="dc-antibiotics" data-add-to-note="true">
                            <span class="goal-pill-icon">ðŸŽ¯</span>
                            <span>Discontinue Antibiotics</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-action-button add-to-note-action" data-system="infectious">
                    <span>ðŸ“</span>
                    <span>Add to Note</span>
                </button>
                <button class="modal-action-button" id="order-cultures-btn">
                    <span>ðŸ§«</span>
                    <span>Order Cultures</span>
                </button>
                <button class="modal-action-button primary" id="dc-antibiotics-btn">
                    <span>ðŸ’Š</span>
                    <span>D/C Antibiotics</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- JavaScript for Interactive Functionality -->
    <script>
        // DOM Elements
        const systemMarkers = document.querySelectorAll('.system-marker');
        const modals = document.querySelectorAll('.modal-overlay');
        const closeButtons = document.querySelectorAll('.modal-close');
        const goalCheckboxes = document.querySelectorAll('.goal-checkbox');
        const sliderInputs = document.querySelectorAll('.slider-input');
        const targetDisplays = document.querySelectorAll('[id$="-target-display"]');
        const generateBtn = document.getElementById('generate-btn');
        const loadingOverlay = document.getElementById('loading-overlay');
        const addToNoteBtn = document.getElementById('add-to-note-btn');
        const addToNoteActions = document.querySelectorAll('.add-to-note-action');
        const historyBtn = document.getElementById('history-btn');
        const historyDropdown = document.getElementById('history-dropdown');
        const saveBtn = document.getElementById('save-btn');
        const signBtn = document.getElementById('sign-btn');
        const toast = document.getElementById('toast');
        const noteSections = document.querySelectorAll('.note-section');
        const noteTabs = document.querySelectorAll('.note-tab');
        const categoryTabs = document.querySelectorAll('.category-tab');
        const orderPanel = document.getElementById('order-panel');
        const closeOrderPanelBtn = document.getElementById('close-order-panel');
        const cancelOrderBtn = document.getElementById('cancel-order');
        const submitOrderBtn = document.getElementById('submit-order');
        const orderTypeSelect = document.getElementById('order-type');
        const orderTimingSelect = document.getElementById('order-timing');
        const customTimingContainer = document.getElementById('custom-timing-container');
        const orderReasonSelect = document.getElementById('order-reason');
        const otherReasonContainer = document.getElementById('other-reason-container');
        const diagnosesModal = document.getElementById('diagnoses-modal');
        const closeDiagnosesModalBtn = document.getElementById('close-diagnoses-modal');
        const saveDiagnosesBtn = document.getElementById('save-diagnoses-btn');
        const closeDiagnosesBtn = document.getElementById('close-diagnoses-btn');
        const manageSystemDxBtns = document.querySelectorAll('[id^="manage-"][id$="-dx"]');

        // Initialize the application
        function init() {
            // Attach event listeners
            attachEventListeners();
            
            // Update slider displays
            updateSliderDisplays();
            
            // Initialize patient summary widget
            initSummaryWidget();
        }

        // Attach event listeners to interactive elements
        function attachEventListeners() {
            // System markers (open modal on click)
            systemMarkers.forEach(marker => {
                marker.addEventListener('click', function() {
                    const system = this.getAttribute('data-system');
                    const modal = document.getElementById(`${system}-modal`);
                    openModal(modal);
                });
            });
            
            // Close buttons for modals
            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal-overlay');
                    closeModal(modal);
                });
            });
            
            // Manage Diagnoses buttons
            manageSystemDxBtns.forEach(button => {
                button.addEventListener('click', function() {
                    const systemId = this.id.replace('manage-', '').replace('-dx', '');
                    openDiagnosesModal(systemId);
                });
            });
            
            // Add Diagnosis button in the diagnosis management modal
            document.getElementById('add-diagnosis-btn')?.addEventListener('click', function() {
                showAddDiagnosisForm();
            });
            
            // Add "Add Medication" button functionality
            document.querySelectorAll('.add-diagnosis-btn').forEach(btn => {
                if (btn.textContent.includes('Add Medication')) {
                    btn.addEventListener('click', function() {
                        showAddMedicationForm();
                    });
                }
            });
            
            // Diagnoses modal close button
            closeDiagnosesModalBtn.addEventListener('click', closeDiagnosesModal);
            closeDiagnosesBtn.addEventListener('click', closeDiagnosesModal);
            saveDiagnosesBtn.addEventListener('click', function() {
                showToast('Diagnoses and medications updated!');
                closeDiagnosesModal();
            });
            
            // Edit and Remove diagnosis buttons
            document.querySelectorAll('.diagnosis-action-btn').forEach(btn => {
                if (btn.title === 'Update') {
                    btn.addEventListener('click', function() {
                        const row = this.closest('tr');
                        const diagnosis = row.querySelector('td:first-child').textContent;
                        const status = row.querySelector('td:nth-child(2)').textContent;
                        showEditDiagnosisForm(diagnosis, status);
                    });
                } else if (btn.title === 'Remove') {
                    btn.addEventListener('click', function() {
                        const row = this.closest('tr');
                        row.remove();
                        showToast('Diagnosis removed');
                    });
                }
            });
            
            // Medication action buttons
            document.querySelectorAll('.medication-action-btn').forEach(btn => {
                if (btn.title === 'Edit') {
                    btn.addEventListener('click', function() {
                        const item = this.closest('.medication-item');
                        const name = item.querySelector('.medication-name').textContent;
                        const dose = item.querySelector('.medication-dose').textContent;
                        showEditMedicationForm(name, dose);
                    });
                } else if (btn.title === 'Discontinue' || btn.title === 'Cancel') {
                    btn.addEventListener('click', function() {
                        const item = this.closest('.medication-item');
                        const statusElement = item.querySelector('.medication-status');
                        statusElement.textContent = 'Discontinued';
                        statusElement.className = 'medication-status discontinued';
                        showToast('Medication discontinued');
                    });
                }
            });
            
            // Order Panel close buttons
            closeOrderPanelBtn.addEventListener('click', closeOrderPanel);
            cancelOrderBtn.addEventListener('click', closeOrderPanel);
            
            // Order Panel submit button
            submitOrderBtn.addEventListener('click', function() {
                const orderTitle = document.getElementById('order-panel-title').textContent.replace('Quick Order: ', '');
                showToast(`${orderTitle} order submitted successfully!`);
                closeOrderPanel();
            });
            
            // Order timing select change
            orderTimingSelect.addEventListener('change', function() {
                customTimingContainer.style.display = this.value === 'custom' ? 'block' : 'none';
            });
            
            // Order reason select change
            orderReasonSelect.addEventListener('change', function() {
                otherReasonContainer.style.display = this.value === 'other' ? 'block' : 'none';
            });
            
            // Goal checkboxes (toggle controls visibility)
            goalCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // Additional functionality can be added here
                    updateProtocolCompliance();
                });
            });
            
            // Slider inputs (update target displays)
            sliderInputs.forEach(slider => {
                slider.addEventListener('input', function() {
                    const id = this.id;
                    const display = document.getElementById(`${id}-display`);
                    if (display) {
                        if (id === 'fio2-target') {
                            display.textContent = `${this.value}%`;
                        } else if (id === 'pip-target') {
                            display.textContent = `${this.value} cmH2O`;
                        } else if (id === 'rate-target') {
                            display.textContent = `${this.value}/min`;
                        } else if (id === 'feeds-target') {
                            display.textContent = `${this.value}ml q3h`;
                        } else {
                            display.textContent = this.value;
                        }
                    }
                });
            });
            
            // Generate button
            generateBtn.addEventListener('click', function() {
                showLoadingOverlay('Generating protocol-driven note...');
                
                // Simulate loading delay
                setTimeout(() => {
                    hideLoadingOverlay();
                    showToast('Note generated successfully!');
                }, 2000);
            });
            
            // Add to Note button
            addToNoteBtn.addEventListener('click', function() {
                showToast('Selected data added to progress note!');
            });
            
            // Add to Note actions in modals
            addToNoteActions.forEach(button => {
                button.addEventListener('click', function() {
                    const system = this.getAttribute('data-system');
                    const modal = this.closest('.modal-overlay');
                    
                    closeModal(modal);
                    showToast(`${system.charAt(0).toUpperCase() + system.slice(1)} data added to note!`);
                });
            });
            
            // History button (toggle dropdown)
            historyBtn.addEventListener('click', function() {
                const isVisible = historyDropdown.style.display === 'block';
                historyDropdown.style.display = isVisible ? 'none' : 'block';
                
                // Position the dropdown
                if (!isVisible) {
                    const rect = historyBtn.getBoundingClientRect();
                    historyDropdown.style.top = `${rect.bottom + 10}px`;
                    historyDropdown.style.left = `${rect.left}px`;
                }
            });
            
            // Save button
            saveBtn.addEventListener('click', function() {
                showToast('Progress note saved!');
            });
            
            // Sign button
            signBtn.addEventListener('click', function() {
                showToast('Progress note signed and submitted!');
            });
            
            // Note section headers (toggle collapsible sections)
            noteSections.forEach(section => {
                const header = section.querySelector('.note-header');
                header.addEventListener('click', function() {
                    section.classList.toggle('collapsed');
                });
            });
            
            // Note tabs
            noteTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    noteTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Handle tab switching logic
                    const tabId = this.getAttribute('data-tab');
                    if (tabId === 'template') {
                        document.getElementById('template-content').style.display = 'block';
                    } else {
                        document.getElementById('template-content').style.display = 'none';
                    }
                });
            });
            
            // Category tabs
            categoryTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    categoryTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Handle category filtering
                    const category = this.getAttribute('data-tab');
                    
                    // Show/hide categories based on selection
                    if (category === 'all') {
                        document.querySelectorAll('.goal-category').forEach(cat => {
                            cat.style.display = 'block';
                        });
                    } else {
                        document.querySelectorAll('.goal-category').forEach(cat => {
                            if (cat.id === `${category}-category`) {
                                cat.style.display = 'block';
                            } else {
                                cat.style.display = 'none';
                            }
                        });
                    }
                });
            });
            
            // Document click to close dropdowns
            document.addEventListener('click', function(event) {
                if (!event.target.closest('#history-btn') && !event.target.closest('#history-dropdown')) {
                    historyDropdown.style.display = 'none';
                }
            });
            
            // Goal action buttons
            document.getElementById('action-decrease-fio2')?.addEventListener('click', () => {
                updateVentParameter('FiO2', '35%', '30%');
                showToast('FiO2 decreased to 30%');
            });
            
            document.getElementById('action-schedule-fio2')?.addEventListener('click', () => {
                openOrderPanel('Schedule FiO2 Wean', 'â±ï¸');
            });
            
            document.getElementById('action-decrease-pip')?.addEventListener('click', () => {
                updateVentParameter('PIP', '22 cmH2O', '20 cmH2O');
                showToast('PIP decreased to 20 cmH2O');
            });
            
            document.getElementById('action-order-abg')?.addEventListener('click', () => {
                openOrderPanel('ABG', 'ðŸ§ª');
            });
            
            document.getElementById('action-change-rate')?.addEventListener('click', () => {
                updateVentParameter('Rate', '40/min', document.getElementById('rate-target-display').textContent);
                showToast(`Ventilator rate changed to ${document.getElementById('rate-target-display').textContent}`);
            });
            
            document.getElementById('action-increase-feeds')?.addEventListener('click', () => {
                updateFeedingParameter('2ml q3h', document.getElementById('feeds-target-display').textContent);
                showToast(`Feeds increased to ${document.getElementById('feeds-target-display').textContent}`);
            });
            
            document.getElementById('action-check-residuals')?.addEventListener('click', () => {
                showToast('Residual check ordered');
            });
            
            document.getElementById('action-dc-antibiotics')?.addEventListener('click', () => {
                showToast('Antibiotics discontinued after final dose');
                document.getElementById('id-content').innerHTML = document.getElementById('id-content').innerHTML.replace('Day 7 of 7', 'Completed 7-day course');
            });
            
            document.getElementById('action-check-cultures')?.addEventListener('click', () => {
                showToast('Culture results checked - negative at 48 hours');
            });
            
            document.getElementById('action-order-echo')?.addEventListener('click', () => {
                openOrderPanel('Echocardiogram', 'ðŸ”Š');
            });
            
            document.getElementById('action-cardio-consult')?.addEventListener('click', () => {
                showToast('Cardiology consult ordered');
            });
            
            document.getElementById('action-order-hus')?.addEventListener('click', () => {
                openOrderPanel('Head Ultrasound', 'ðŸ§ ');
            });
            
            document.getElementById('action-neuro-consult')?.addEventListener('click', () => {
                showToast('Neurology consult ordered');
            });
            
            // Order buttons in modals
            document.getElementById('order-abg-btn')?.addEventListener('click', () => {
                openOrderPanel('ABG', 'ðŸ§ª');
            });
            
            document.getElementById('adjust-vent-btn')?.addEventListener('click', () => {
                showToast('Vent settings adjusted');
            });
            
            document.getElementById('order-hus-btn')?.addEventListener('click', () => {
                openOrderPanel('Head Ultrasound', 'ðŸ§ ');
            });
            
            document.getElementById('neuro-consult-btn')?.addEventListener('click', () => {
                showToast('Neurology consult ordered');
            });
            
            document.getElementById('order-echo-btn')?.addEventListener('click', () => {
                openOrderPanel('Echocardiogram', 'ðŸ”Š');
            });
            
            document.getElementById('cardio-consult-btn')?.addEventListener('click', () => {
                showToast('Cardiology consult ordered');
            });
            
            document.getElementById('adjust-tpn-btn')?.addEventListener('click', () => {
                showToast('TPN adjusted');
            });
            
            document.getElementById('advance-feeds-btn')?.addEventListener('click', () => {
                updateFeedingParameter('2ml q3h', '4ml q3h');
                showToast('Feeds advanced to 4ml q3h');
            });
            
            document.getElementById('order-cultures-btn')?.addEventListener('click', () => {
                openOrderPanel('Blood Culture', 'ðŸ§«');
            });
            
            document.getElementById('dc-antibiotics-btn')?.addEventListener('click', () => {
                showToast('Antibiotics discontinued after final dose');
                document.getElementById('id-content').innerHTML = document.getElementById('id-content').innerHTML.replace('Day 7 of 7', 'Completed 7-day course');
            });
        }

        // Open a modal
        function openModal(modal) {
            if (modal) {
                modal.classList.add('visible');
            }
        }

        // Close a modal
        function closeModal(modal) {
            if (modal) {
                modal.classList.remove('visible');
            }
        }
        
        // Open diagnoses modal
        function openDiagnosesModal(systemId) {
            const systemName = getSystemName(systemId);
            const systemIcon = getSystemIcon(systemId);
            
            document.getElementById('diagnoses-system-title').textContent = `${systemName} Diagnoses`;
            document.getElementById('diagnoses-system-icon').textContent = systemIcon;
            
            // Customize diagnosis table based on the system
            customizeDiagnosisTable(systemId);
            
            diagnosesModal.classList.add('visible');
        }
        
        // Close diagnoses modal
        function closeDiagnosesModal() {
            diagnosesModal.classList.remove('visible');
        }
        
        // Customize diagnosis table based on the system
        function customizeDiagnosisTable(systemId) {
            const diagnosisTable = document.getElementById('diagnosis-table');
            const tbody = diagnosisTable.querySelector('tbody');
            
            // Clear existing rows
            tbody.innerHTML = '';
            
            // Add system-specific diagnoses
            switch(systemId) {
                case 'respiratory':
                    addDiagnosisRow(tbody, 'Respiratory Distress Syndrome', 'Improving', 'DOL 0');
                    addDiagnosisRow(tbody, 'Evolving Bronchopulmonary Dysplasia', 'Early phase', 'DOL 14');
                    break;
                case 'neuro':
                    addDiagnosisRow(tbody, 'Grade II Intraventricular Hemorrhage', 'Stable', 'DOL 3');
                    addDiagnosisRow(tbody, 'Prematurity-Associated Neurological Risk', 'Monitoring', 'DOL 0');
                    break;
                case 'cardiac':
                    addDiagnosisRow(tbody, 'Patent Ductus Arteriosus', 'Moderate', 'DOL 1');
                    break;
                case 'gi':
                    addDiagnosisRow(tbody, 'Feeding Intolerance', 'Resolved', 'DOL 5-10');
                    break;
                case 'infectious':
                    addDiagnosisRow(tbody, 'Rule Out Sepsis', 'Ruled out', 'DOL 0-7');
                    break;
                default:
                    addDiagnosisRow(tbody, 'No specific diagnoses', '-', '-');
            }
        }
        
        // Add a diagnosis row to the table
        function addDiagnosisRow(tbody, diagnosis, status, date) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${diagnosis}</td>
                <td>${status}</td>
                <td>${date}</td>
                <td class="diagnosis-actions">
                    <button class="diagnosis-action-btn" title="Update">âœï¸</button>
                    <button class="diagnosis-action-btn" title="Remove">âŒ</button>
                </td>
            `;
            tbody.appendChild(tr);
        }
        
        // Open order panel
        function openOrderPanel(orderType, icon) {
            document.getElementById('order-panel-title').textContent = `Quick Order: ${orderType}`;
            document.getElementById('order-panel-icon').textContent = icon || 'ðŸ§ª';
            
            // Reset form
            document.getElementById('order-type').value = 'routine';
            document.getElementById('order-timing').value = 'now';
            document.getElementById('order-reason').value = 'protocol';
            document.getElementById('order-special-instructions').value = '';
            document.getElementById('custom-timing-container').style.display = 'none';
            document.getElementById('other-reason-container').style.display = 'none';
            
            orderPanel.classList.add('visible');
        }
        
        // Close order panel
        function closeOrderPanel() {
            orderPanel.classList.remove('visible');
        }
        
        // Update ventilator parameter in note
        function updateVentParameter(param, currentValue, newValue) {
            const respiratoryContent = document.getElementById('respiratory-content');
            const currentText = respiratoryContent.innerHTML;
            
            // Update the parameter in the note
            const updatedText = currentText.replace(
                `${param} ${currentValue}`,
                `${param} ${newValue}`
            );
            
            respiratoryContent.innerHTML = updatedText;
            
            // Also update the banner display
            updateBannerDisplay();
        }
        
        // Update feeding parameter in note
        function updateFeedingParameter(currentValue, newValue) {
            const giContent = document.getElementById('gi-content');
            const currentText = giContent.innerHTML;
            
            // Update the parameter in the note
            const updatedText = currentText.replace(
                `Current Feeds: Breastmilk ${currentValue} (trophic)`,
                `Current Feeds: Breastmilk ${newValue} (advancing)`
            );
            
            giContent.innerHTML = updatedText;
            
            // Also update the feed status in the banner
            document.getElementById('feed-status').textContent = `Feeds: ${newValue} + TPN`;
        }
        
        // Update banner display with current vent settings
        function updateBannerDisplay() {
            const respiratoryContent = document.getElementById('respiratory-content');
            const ventSettingsMatch = respiratoryContent.innerHTML.match(/Rate (\d+), PIP (\d+), PEEP (\d+), FiO2 (\d+)%/);
            
            if (ventSettingsMatch) {
                const [, rate, pip, peep, fio2] = ventSettingsMatch;
                document.getElementById('vent-settings').textContent = `Vent: Rate ${rate}, PIP ${pip}, PEEP ${peep}, FiO2 ${fio2}%`;
            }
        }
        
        // Update protocol compliance indicators
        function updateProtocolCompliance() {
            // This would update compliance based on checkbox states
            const respiratoryCompliance = document.querySelectorAll('#respiratory-category .goal-checkbox:checked').length;
            const respiratoryTotal = document.querySelectorAll('#respiratory-category .goal-checkbox').length;
            
            document.querySelector('#respiratory-category .protocol-status').textContent = `${respiratoryCompliance}/${respiratoryTotal}`;
            
            // Update overall compliance
            const totalChecked = document.querySelectorAll('.goal-checkbox:checked').length;
            const totalGoals = document.querySelectorAll('.goal-checkbox').length;
            
            const compliancePercent = Math.round((totalChecked / totalGoals) * 100);
            document.querySelector('.clinical-alert strong').textContent = `Protocol Compliance: ${compliancePercent}%`;
            document.querySelector('.progress-bar').style.width = `${compliancePercent}%`;
        }
        
        // Make the patient summary widget draggable and add minimize/hide functionality
        function initSummaryWidget() {
            const summary = document.getElementById('patient-summary');
            const minimizeBtn = document.getElementById('minimize-summary');
            const hideBtn = document.getElementById('hide-summary');
            const showBtn = document.getElementById('show-summary');
            
            if (!summary || !minimizeBtn || !hideBtn || !showBtn) return;
            
            // Make widget draggable
            let isDragging = false;
            let offsetX, offsetY;
            
            summary.addEventListener('mousedown', function(e) {
                if (e.target.closest('.summary-control-btn')) return;
                
                isDragging = true;
                offsetX = e.clientX - summary.getBoundingClientRect().left;
                offsetY = e.clientY - summary.getBoundingClientRect().top;
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                summary.style.left = (e.clientX - offsetX) + 'px';
                summary.style.top = (e.clientY - offsetY) + 'px';
            });
            
            document.addEventListener('mouseup', function() {
                isDragging = false;
            });
            
            // Minimize button
            minimizeBtn.addEventListener('click', function() {
                summary.classList.toggle('minimized');
                minimizeBtn.textContent = summary.classList.contains('minimized') ? 'â–¡' : '_';
                minimizeBtn.title = summary.classList.contains('minimized') ? 'Maximize' : 'Minimize';
            });
            
            // Hide button - actually hide it completely now
            hideBtn.addEventListener('click', function() {
                summary.style.display = 'none';
            });
            
            // Show button is not needed as we're completely hiding the element
            showBtn.style.display = 'none';
            
            // Add a show summary button to the main interface
            const showSummaryBtn = document.createElement('button');
            showSummaryBtn.textContent = 'Show Summary';
            showSummaryBtn.classList.add('tool-button');
            showSummaryBtn.style.position = 'absolute';
            showSummaryBtn.style.top = '15px';
            showSummaryBtn.style.left = '380px';
            showSummaryBtn.style.zIndex = '40';
            showSummaryBtn.style.display = 'none';
            
            showSummaryBtn.addEventListener('click', function() {
                summary.style.display = 'block';
                showSummaryBtn.style.display = 'none';
            });
            
            hideBtn.addEventListener('click', function() {
                summary.style.display = 'none';
                showSummaryBtn.style.display = 'block';
            });
            
            document.body.appendChild(showSummaryBtn);
        }

        // Show loading overlay
        function showLoadingOverlay(text) {
            const loadingText = document.getElementById('loading-text');
            if (loadingText) {
                loadingText.textContent = text || 'Loading...';
            }
            
            loadingOverlay.style.opacity = '1';
            loadingOverlay.style.visibility = 'visible';
        }

        // Show Add Diagnosis Form
        function showAddDiagnosisForm() {
            // Create a custom modal for adding diagnosis
            const modal = document.createElement('div');
            modal.className = 'custom-modal visible';
            modal.innerHTML = `
                <div class="custom-modal-content">
                    <div class="custom-modal-header">
                        <div class="custom-modal-title">
                            <span>âž•</span>
                            <span>Add New Diagnosis</span>
                        </div>
                        <button class="modal-control-button" id="close-add-diagnosis">âœ–ï¸</button>
                    </div>
                    <div class="custom-modal-body">
                        <div class="form-group">
                            <label class="form-label">Diagnosis</label>
                            <input type="text" class="form-input" id="new-diagnosis-name" placeholder="Enter diagnosis name...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="new-diagnosis-status">
                                <option value="Active">Active</option>
                                <option value="Improving">Improving</option>
                                <option value="Resolving">Resolving</option>
                                <option value="Resolved">Resolved</option>
                                <option value="Worsening">Worsening</option>
                                <option value="Monitoring">Monitoring</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input type="text" class="form-input" id="new-diagnosis-date" placeholder="e.g., DOL 5" value="DOL 16">
                        </div>
                    </div>
                    <div class="custom-modal-footer">
                        <button class="modal-action-button" id="cancel-add-diagnosis">Cancel</button>
                        <button class="modal-action-button primary" id="confirm-add-diagnosis">Add Diagnosis</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('close-add-diagnosis').addEventListener('click', function() {
                modal.remove();
            });
            
            document.getElementById('cancel-add-diagnosis').addEventListener('click', function() {
                modal.remove();
            });
            
            document.getElementById('confirm-add-diagnosis').addEventListener('click', function() {
                const diagnosisName = document.getElementById('new-diagnosis-name').value;
                const status = document.getElementById('new-diagnosis-status').value;
                const date = document.getElementById('new-diagnosis-date').value;
                
                if (diagnosisName.trim() !== '') {
                    const tbody = document.querySelector('#diagnosis-table tbody');
                    addDiagnosisRow(tbody, diagnosisName, status, date);
                    showToast('New diagnosis added');
                    modal.remove();
                } else {
                    showToast('Diagnosis name cannot be empty');
                }
            });
        }
        
        // Show Edit Diagnosis Form
        function showEditDiagnosisForm(diagnosis, currentStatus) {
            // Create a custom modal for editing diagnosis
            const modal = document.createElement('div');
            modal.className = 'custom-modal visible';
            modal.innerHTML = `
                <div class="custom-modal-content">
                    <div class="custom-modal-header">
                        <div class="custom-modal-title">
                            <span>âœï¸</span>
                            <span>Edit Diagnosis</span>
                        </div>
                        <button class="modal-control-button" id="close-edit-diagnosis">âœ–ï¸</button>
                    </div>
                    <div class="custom-modal-body">
                        <div class="form-group">
                            <label class="form-label">Diagnosis</label>
                            <input type="text" class="form-input" id="edit-diagnosis-name" value="${diagnosis}" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="edit-diagnosis-status">
                                <option value="Active" ${currentStatus === 'Active' ? 'selected' : ''}>Active</option>
                                <option value="Improving" ${currentStatus === 'Improving' ? 'selected' : ''}>Improving</option>
                                <option value="Resolving" ${currentStatus === 'Resolving' ? 'selected' : ''}>Resolving</option>
                                <option value="Resolved" ${currentStatus === 'Resolved' ? 'selected' : ''}>Resolved</option>
                                <option value="Worsening" ${currentStatus === 'Worsening' ? 'selected' : ''}>Worsening</option>
                                <option value="Monitoring" ${currentStatus === 'Monitoring' ? 'selected' : ''}>Monitoring</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-textarea" id="edit-diagnosis-notes" placeholder="Add clinical notes..."></textarea>
                        </div>
                    </div>
                    <div class="custom-modal-footer">
                        <button class="modal-action-button" id="cancel-edit-diagnosis">Cancel</button>
                        <button class="modal-action-button primary" id="confirm-edit-diagnosis">Update Diagnosis</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('close-edit-diagnosis').addEventListener('click', function() {
                modal.remove();
            });
            
            document.getElementById('cancel-edit-diagnosis').addEventListener('click', function() {
                modal.remove();
            });
            
            document.getElementById('confirm-edit-diagnosis').addEventListener('click', function() {
                const diagnosisName = document.getElementById('edit-diagnosis-name').value;
                const newStatus = document.getElementById('edit-diagnosis-status').value;
                
                // Find and update the diagnosis row
                const rows = document.querySelectorAll('#diagnosis-table tbody tr');
                for (let row of rows) {
                    const nameCell = row.querySelector('td:first-child');
                    if (nameCell && nameCell.textContent === diagnosis) {
                        const statusCell = row.querySelector('td:nth-child(2)');
                        if (statusCell) statusCell.textContent = newStatus;
                        break;
                    }
                }
                
                showToast('Diagnosis updated');
                modal.remove();
            });
        }
        
        // Show Add Medication Form
        function showAddMedicationForm() {
            // Create a custom modal for adding medication
            const modal = document.createElement('div');
            modal.className = 'custom-modal visible';
            modal.innerHTML = `
                <div class="custom-modal-content">
                    <div class="custom-modal-header">
                        <div class="custom-modal-title">
                            <span>ðŸ’Š</span>
                            <span>Add New Medication</span>
                        </div>
                        <button class="modal-control-button" id="close-add-med">âœ–ï¸</button>
                    </div>
                    <div class="custom-modal-body">
                        <div class="form-group">
                            <label class="form-label">Medication</label>
                            <input type="text" class="form-input" id="new-med-name" placeholder="Enter medication name...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dose</label>
                            <input type="text" class="form-input" id="new-med-dose" placeholder="e.g., 5 mg/kg/day">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Route</label>
                            <select class="form-select" id="new-med-route">
                                <option value="IV">IV</option>
                                <option value="PO">PO</option>
                                <option value="IM">IM</option>
                                <option value="Inhaled">Inhaled</option>
                                <option value="Topical">Topical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Frequency</label>
                            <select class="form-select" id="new-med-frequency">
                                <option value="q24h">q24h</option>
                                <option value="q12h">q12h</option>
                                <option value="q8h">q8h</option>
                                <option value="q6h">q6h</option>
                                <option value="q4h">q4h</option>
                                <option value="PRN">PRN</option>
                                <option value="One time">One time</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Associated Diagnosis</label>
                            <select class="form-select" id="new-med-diagnosis">
                                <option value="">None</option>
                            </select>
                        </div>
                    </div>
                    <div class="custom-modal-footer">
                        <button class="modal-action-button" id="cancel-add-med">Cancel</button>
                        <button class="modal-action-button primary" id="confirm-add-med">Add Medication</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Populate diagnosis dropdown
            const diagnosisSelect = document.getElementById('new-med-diagnosis');
            const diagnosisRows = document.querySelectorAll('#diagnosis-table tbody tr');
            diagnosisRows.forEach(row => {
                const diagnosis = row.querySelector('td:first-child').textContent;
                const option = document.createElement('option');
                option.value = diagnosis;
                option.textContent = diagnosis;
                diagnosisSelect.appendChild(option);
            });
            
            // Add event listeners
            document.getElementById('close-add-med').addEventListener('click', function() {
                modal.remove();
            });
            
            document.getElementById('cancel-add-med').addEventListener('click', function() {
                modal.remove();
            });
            
            document.getElementById('confirm-add-med').addEventListener('click', function() {
                const medName = document.getElementById('new-med-name').value;
                const dose = document.getElementById('new-med-dose').value;
                const route = document.getElementById('new-med-route').value;
                const frequency = document.getElementById('new-med-frequency').value;
                
                if (medName.trim() !== '' && dose.trim() !== '') {
                    // Add new medication
                    const medList = document.querySelector('.medication-list');
                    const newMed = document.createElement('div');
                    newMed.className = 'medication-item';
                    newMed.innerHTML = `
                        <div class="medication-info">
                            <div class="medication-name">${medName}</div>
                            <div class="medication-dose">${dose} ${route} ${frequency}</div>
                        </div>
                        <div class="medication-status active">Active</div>
                        <div class="medication-controls">
                            <button class="medication-action-btn" title="Edit">âœï¸</button>
                            <button class="medication-action-btn" title="Discontinue">â¹ï¸</button>
                        </div>
                    `;
                    
                    // Add event listeners to new buttons
                    const editBtn = newMed.querySelector('[title="Edit"]');
                    editBtn.addEventListener('click', function() {
                        showEditMedicationForm(medName, dose);
                    });
                    
                    const discontinueBtn = newMed.querySelector('[title="Discontinue"]');
                    discontinueBtn.addEventListener('click', function() {
                        const statusElement = newMed.querySelector('.medication-status');
                        statusElement.textContent = 'Discontinued';
                        statusElement.className = 'medication-status discontinued';
                        showToast('Medication discontinued');
                    });
                    
                    medList.appendChild(newMed);
                    showToast('New medication added');
                    modal.remove();
                } else {
                    showToast('Medication name and dose cannot be empty');
                }
            });
        }
        
        // Show Edit Medication Form
        function showEditMedicationForm(medication, currentDose) {
            // Create a custom modal for editing medication
            const modal = document.createElement('div');
            modal.className = 'custom-modal visible';
            modal.innerHTML = `
                <div class="custom-modal-content">
                    <div class="custom-modal-header">
                        <div class="custom-modal-title">
                            <span>âœï¸</span>
                            <span>Edit Medication</span>
                        </div>
                        <button class="modal-control-button" id="close-edit-med">âœ–ï¸</button>
                    </div>
                    <div class="custom-modal-body">
                        <div class="form-group">
                            <label class="form-label">Medication</label>
                            <input type="text" class="form-input" id="edit-med-name" value="${medication}" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dose</label>
                            <input type="text" class="form-input" id="edit-med-dose" value="${currentDose}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-textarea" id="edit-med-notes" placeholder="Add medication notes..."></textarea>
                        </div>
                    </div>
                    <div class="custom-modal-footer">
                        <button class="modal-action-button" id="cancel-edit-med">Cancel</button>
                        <button class="modal-action-button primary" id="confirm-edit-med">Update Medication</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('close-edit-med').addEventListener('click', function() {
                modal.remove();
            });
            
            document.getElementById('cancel-edit-med').addEventListener('click', function() {
                modal.remove();
            });
            
            document.getElementById('confirm-edit-med').addEventListener('click', function() {
                const newDose = document.getElementById('edit-med-dose').value;
                
                // Find and update the medication
                const medicationItems = document.querySelectorAll('.medication-item');
                for (let item of medicationItems) {
                    const nameElement = item.querySelector('.medication-name');
                    if (nameElement && nameElement.textContent === medication) {
                        const doseElement = item.querySelector('.medication-dose');
                        if (doseElement) doseElement.textContent = newDose;
                        break;
                    }
                }
                
                showToast('Medication updated');
                modal.remove();
            });
        }

        // Update all slider displays
        function updateSliderDisplays() {
            sliderInputs.forEach(slider => {
                const id = slider.id;
                const display = document.getElementById(`${id}-display`);
                if (display) {
                    if (id === 'fio2-target') {
                        display.textContent = `${slider.value}%`;
                    } else if (id === 'pip-target') {
                        display.textContent = `${slider.value} cmH2O`;
                    } else if (id === 'rate-target') {
                        display.textContent = `${slider.value}/min`;
                    } else if (id === 'feeds-target') {
                        display.textContent = `${slider.value}ml q3h`;
                    } else {
                        display.textContent = slider.value;
                    }
                }
            });
        }

        // Hide loading overlay
        function hideLoadingOverlay() {
            loadingOverlay.style.opacity = '0';
            loadingOverlay.style.visibility = 'hidden';
        }
        
        // Show a toast notification
        function showToast(message) {
            toast.textContent = message;
            toast.style.opacity = '1';
            
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 3000);
        }
        
        // Get system name from ID
        function getSystemName(systemId) {
            const systemNames = {
                'respiratory': 'Respiratory System',
                'neuro': 'Neurological System',
                'cardiac': 'Cardiovascular System',
                'gi': 'Gastrointestinal System',
                'infectious': 'Infectious Disease',
                'renal': 'Renal System',
                'skin': 'Integumentary System',
                'endocrine': 'Endocrine System'
            };
            
            return systemNames[systemId] || systemId;
        }

        // Get system icon from ID
        function getSystemIcon(systemId) {
            const systemIcons = {
                'respiratory': 'ðŸ«',
                'neuro': 'ðŸ§ ',
                'cardiac': 'â¤ï¸',
                'gi': 'ðŸ½ï¸',
                'infectious': 'ðŸ¦ ',
                'renal': 'ðŸŽ‹',
                'skin': 'ðŸ§¬',
                'endocrine': 'âš—ï¸'
            };
            
            return systemIcons[systemId] || 'ðŸ“‹';
        }

        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
                            <span>Wean FiO2 to 30%</span>
                        </div>
                        <div class="goal-pill" data-goal="pip" data-add-to-note="true">
                            <span class="goal-pill-icon">ðŸŽ¯</span>
                            <span>Wean PIP to 20 cmH2O</span>
                        </div>
                        <div class="goal-pill" data-goal="maintain-rate" data-add-to-note="true">
                            <span class="goal-pill-icon">ðŸŽ¯</span>
                            <span>Maintain Rate at 40/min</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-action-button add-to-note-action" data-system="respiratory">
                    <span>ðŸ“</span>
                    <span>Add to Note</span>
                </button>
                <button class="modal-action-button" id="order-abg-btn">
                    <span>ðŸ§ª</span>
                    <span>Order ABG</span>
                </button>
                <button class="modal-action-button primary" id="adjust-vent-btn">
                    <span>âš™ï¸</span>
                    <span>Adjust Vent</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Neurology Modal -->
    <div class="modal-overlay" id="neuro-modal">
        <div class="system-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>ðŸ§ </span>
                    <span>Neurological System</span>
                    <span class="system-status status-warning">Warning</span>
                </div>
                <div class="modal-controls">
                    <button class="modal-control-button" id="manage-neuro-dx">ðŸ“‹</button>
                    <button class="modal-control-button modal-close">âœ–ï¸</button>
                </div>
            </div>
            <div class="modal-content">
                <div class="modal-section">
                    <div class="section-title">Protocol Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Protocol Compliance</div>
                            <div class="stat-value">IVH Monitoring: 100%</div>
                            <div class="stat-time">Current</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">HUS Protocol</div>
                            <div class="stat-value">Compliant - Weekly imaging</div>
                            <div class="stat-time">On schedule</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Next Scheduled HUS</div>
                            <div class="stat-value">7 days</div>
                            <div class="stat-time">From today</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Diagnoses</div>
                    <div class="condition-list">
                        <div class="condition-item">
                            <div class="condition-name">
                                <span>âš ï¸</span>
                                <span>Grade II Intraventricular Hemorrhage (IVH)</span>
                            </div>
                            <div class="condition-status">Stable</div>
                        </div>
                        <div class="condition-item">
                            <div class="condition-name">
                                <span>â„¹ï¸</span>
                                <span>Prematurity-Associated Neurological Risk</span>
                            </div>
                            <div class="condition-status">Monitoring</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Current Status</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-name">Head Ultrasound</div>
                            <div class="stat-value">Grade II IVH, no progression</div>
                            <div class="stat-time">5 days ago</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Head Circumference</div>
                            <div class="stat-value">23.5 cm (50th percentile for GA)</div>
                            <div class="stat-time">Today</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Fontanelle</div>
                            <div class="stat-value">Soft, flat</div>
                            <div class="stat-time">Today's exam</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">Neurological Exam</div>
                            <div class="stat-value">Appropriate for gestational age</div>
                            <div class="stat-time">Today</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Clinical Notes</div>
                    <div class="modal-notes">
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Dr. Nelson, Neonatology</div>
                                <div>5 days ago, 15:30</div>
                            </div>
                            <div class="note-text">
                                HUS shows stable Grade II IVH with no extension. No ventricular dilation. Recommend continued weekly monitoring per protocol.
                            </div>
                        </div>
                        <div class="note-item">
                            <div class="note-metadata">
                                <div>Dr. Martinez, Neonatology</div>
                                <div>Today, 07:35</div>
                            </div>
                            <div class="note-text">
                                Neurological exam appropriate for corrected GA. Mild hypotonia, expected at 26 3/7 weeks. No focal deficits. Continue monitoring per protocol.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <div class="section-title">Related Goals</div>
                    <div class="goals-section">
                        <div class="goal-pill" data-goal="monitor-ivh" data-add-to-note="true">
                            <span class="goal-pill-icon">ðŸŽ¯</span>